<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>grand.dataio.root_trees &mdash; grandlib 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            grandlib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">grandlib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../grand.html">grand</a></li>
      <li class="breadcrumb-item active">grand.dataio.root_trees</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for grand.dataio.root_trees</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Read/Write python interface to GRAND data (real and simulated) stored in Cern ROOT TTrees.</span>

<span class="sd">This is the interface for accessing GRAND ROOT TTrees that do not require the user (reader/writer of the TTrees) to have any knowledge of ROOT. It also hides the internals from the data generator, so that the changes in the format are not concerning the user.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">ROOT</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">array</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="c1"># Conversion between numpy dtype and array.array typecodes</span>
<span class="n">numpy_to_array_typecodes</span> <span class="o">=</span> <span class="p">{</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int8&#39;</span><span class="p">):</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int16&#39;</span><span class="p">):</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">):</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">):</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">):</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;uint16&#39;</span><span class="p">):</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;uint32&#39;</span><span class="p">):</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;uint64&#39;</span><span class="p">):</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">):</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">):</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;complex64&#39;</span><span class="p">):</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;complex128&#39;</span><span class="p">):</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int16&#39;</span><span class="p">):</span> <span class="s1">&#39;h&#39;</span><span class="p">}</span>
<span class="c1"># numpy_to_array_typecodes = {np.int8: &#39;b&#39;, np.int16: &#39;h&#39;, np.int32: &#39;i&#39;, np.int64: &#39;q&#39;, np.uint8: &#39;B&#39;, np.uint16: &#39;H&#39;, np.uint32: &#39;I&#39;, np.uint64: &#39;Q&#39;, np.float32: &#39;f&#39;, np.float64: &#39;d&#39;, np.complex64: &#39;F&#39;, np.complex128: &#39;D&#39;, &quot;int8&quot;: &#39;b&#39;, &quot;int16&quot;: &#39;h&#39;, &quot;int32&quot;: &#39;i&#39;, &quot;int64&quot;: &#39;q&#39;, &quot;uint8&quot;: &#39;B&#39;, &quot;uint16&quot;: &#39;H&#39;, &quot;uint32&quot;: &#39;I&#39;, &quot;uint64&quot;: &#39;Q&#39;, &quot;float32&quot;: &#39;f&#39;, &quot;float64&quot;: &#39;d&#39;, &quot;complex64&quot;: &#39;F&#39;, &quot;complex128&quot;: &#39;D&#39;}</span>

<span class="c1"># Conversion between C++ type and array.array typecodes</span>
<span class="n">cpp_to_array_typecodes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;char&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;short&#39;</span><span class="p">:</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;long long&#39;</span><span class="p">:</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned char&#39;</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned short&#39;</span><span class="p">:</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned int&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned long long&#39;</span><span class="p">:</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">:</span> <span class="s1">&#39;u&#39;</span><span class="p">}</span>

<span class="c1"># This import changes in Python 3.10</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">minor</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="n">thismodule</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">## A list of generated Trees</span>
<span class="n">grand_tree_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="sd">&quot;&quot;&quot;Internal list of generated Trees&quot;&quot;&quot;</span>


<span class="c1"># _ups: StdVectorList[&quot;float&quot;]() = field(default_factory=lambda: StdVectorList(&quot;float&quot;))</span>


<div class="viewcode-block" id="StdVectorList">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.StdVectorList">[docs]</a>
<span class="k">class</span> <span class="nc">StdVectorList</span><span class="p">(</span><span class="n">MutableSequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A python list interface to ROOT&#39;s std::vector&quot;&quot;&quot;</span>

    <span class="c1"># vec_type = &quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vec_type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            vec_type: C++ type for the std::vector (eg. &quot;float&quot;, &quot;string&quot;, etc.)</span>
<span class="sd">            value: list with which to init the vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="n">vec_type</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1">#: C++ type for the std::vector (eg. &quot;float&quot;, &quot;string&quot;, etc.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vec_type</span> <span class="o">=</span> <span class="n">vec_type</span>
        <span class="c1"># Basic type of the vector - different than vec_type in case of vector of vectors</span>
        <span class="k">if</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vec_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vec_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vec_type</span>
        <span class="c1"># The number of dimensions of this vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">vec_type</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;vector&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="o">.</span><span class="n">erase</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

<div class="viewcode-block" id="StdVectorList.insert">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.StdVectorList.insert">[docs]</a>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert the value to the vector at index&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="c1"># If this is a vector of vectors, convert a subvector to list for the return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;std.vector&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">[</span><span class="n">index</span><span class="p">])):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">el1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;list index out of range&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># Make comparisons to lists with same contents true</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">)</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">el1</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span>

<div class="viewcode-block" id="StdVectorList.append">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.StdVectorList.append">[docs]</a>
    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Append the value to the list&quot;&quot;&quot;</span>
        <span class="c1"># std::vector does not want numpy types for push_back, need to use .item()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">generic</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="o">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpp_to_array_typecodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpp_to_array_typecodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="p">],</span> <span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="p">[[</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpp_to_array_typecodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="p">],</span> <span class="n">el1</span><span class="p">)</span> <span class="k">for</span> <span class="n">el1</span> <span class="ow">in</span> <span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="o">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="StdVectorList.clear">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.StdVectorList.clear">[docs]</a>
    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove all the values from the vector&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;std.vector&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">])</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector</span><span class="p">))</span>

    <span class="c1"># The standard way of adding stuff to a ROOT.vector is +=. However, for ndim&gt;2 it wants only list, so let&#39;s always give it a list</span>
    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="c1"># function modified by Jelena to fix the negative issue, use at own risk</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpp_to_array_typecodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpp_to_array_typecodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="p">],</span> <span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="p">[[</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpp_to_array_typecodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="p">],</span> <span class="n">el1</span><span class="p">)</span> <span class="k">for</span> <span class="n">el1</span> <span class="ow">in</span> <span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># The list needs to have simple Python types - ROOT.vector does not accept numpy types</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span> <span class="o">+=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># Slow conversion to simple types. No better idea for now</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="s2">&quot;short&quot;</span><span class="p">,</span> <span class="s2">&quot;char&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpp_to_array_typecodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpp_to_array_typecodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="p">],</span> <span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="p">[[</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cpp_to_array_typecodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="p">],</span> <span class="n">el1</span><span class="p">)</span> <span class="k">for</span> <span class="n">el1</span> <span class="ow">in</span> <span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_vector</span> <span class="o">+=</span> <span class="n">value</span>

        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
            <span class="c1"># Handle the OverflowError here, e.g., by logging a message or taking an appropriate action.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="c1"># Use signed integer types to allow for negative values</span>
                <span class="n">signed_type</span> <span class="o">=</span> <span class="s1">&#39;l&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_vec_type</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">signed_type</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">signed_type</span><span class="p">,</span> <span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">[[</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">signed_type</span><span class="p">,</span> <span class="n">el1</span><span class="p">)</span> <span class="k">for</span> <span class="n">el1</span> <span class="ow">in</span> <span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>



<div class="viewcode-block" id="StdVectorListDesc">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.StdVectorListDesc">[docs]</a>
<span class="k">class</span> <span class="nc">StdVectorListDesc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A descriptor for StdVectorList - makes use of it possible in dataclasses without setting property and setter&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vec_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">StdVectorList</span><span class="p">(</span><span class="n">vec_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="StdVectorListDesc.create_default">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.StdVectorListDesc.create_default">[docs]</a>
    <span class="k">def</span> <span class="nf">create_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="c1"># This is needed for default init as a field of an upper class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StdVectorListDesc</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">_vector</span>
        <span class="c1"># A list was given</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StdVectorList</span><span class="p">):</span>
            <span class="c1"># Clear the vector before setting</span>
            <span class="n">vector</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">inst</span> <span class="o">+=</span> <span class="n">value</span>
        <span class="c1"># A vector of vectors was given</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">vec_type</span><span class="p">)):</span>
            <span class="n">vector</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;vector&quot;</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">vec_type</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Incorrect type for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">. Either a list of lists, a list of arrays or a ROOT.vector of vectors required.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Incorrect type for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">. Either a list, an array or a ROOT.vector required.&quot;</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="TTreeScalarDesc">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TTreeScalarDesc">[docs]</a>
<span class="k">class</span> <span class="nc">TTreeScalarDesc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A descriptor for scalars assigned to TTrees as numpy arrays of size 1 - makes use of it possible in dataclasses without setting property and setter&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="TTreeScalarDesc.create_default">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TTreeScalarDesc.create_default">[docs]</a>
    <span class="k">def</span> <span class="nf">create_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="c1"># This is needed for default init as a field of an upper class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">TTreeScalarDesc</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>

        <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="TTreeArrayDesc">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TTreeArrayDesc">[docs]</a>
<span class="k">class</span> <span class="nc">TTreeArrayDesc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A descriptor for numpy arrays stored in TTrees. Ensures the type and converts to array (in case of for eg. list). Makes use of it possible in dataclasses without setting property and setter&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>

    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="TTreeArrayDesc.create_default">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TTreeArrayDesc.create_default">[docs]</a>
    <span class="k">def</span> <span class="nf">create_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="c1"># This is needed for default init as a field of an upper class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">TTreeArrayDesc</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>

        <span class="n">inst</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="StdString">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.StdString">[docs]</a>
<span class="k">class</span> <span class="nc">StdString</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A python string interface to ROOT&#39;s std::string&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="p">)</span></div>


<div class="viewcode-block" id="StdStringDesc">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.StdStringDesc">[docs]</a>
<span class="k">class</span> <span class="nc">StdStringDesc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A descriptor for strings assigned to TTrees as python strings - makes use of it possible in dataclasses without setting property and setter&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="StdStringDesc.create_default">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.StdStringDesc.create_default">[docs]</a>
    <span class="k">def</span> <span class="nf">create_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># Not a string was given</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StdStringDesc</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Incorrect type for site </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">. Either a string or a ROOT.std.string is required.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="c1"># This is needed for default init as a field of an upper class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StdStringDesc</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrname</span><span class="p">)</span>

        <span class="n">inst</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="DataTree">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DataTree</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mother class for GRAND Tree data classes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">## File handle</span>
    <span class="n">_file</span><span class="p">:</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;File handle&quot;&quot;&quot;</span>
    <span class="c1">## File name</span>
    <span class="n">_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;File name&quot;&quot;&quot;</span>
    <span class="c1">## Tree object</span>
    <span class="n">_tree</span><span class="p">:</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TTree</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tree object&quot;&quot;&quot;</span>
    <span class="c1">## Tree name</span>
    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tree name&quot;&quot;&quot;</span>
    <span class="c1">## Tree type</span>
    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tree type&quot;&quot;&quot;</span>
    <span class="c1">## A list of run_numbers or (run_number, event_number) pairs in the Tree</span>
    <span class="n">_entry_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of run_numbers or (run_number, event_number) pairs in the Tree&quot;&quot;&quot;</span>
    <span class="c1">## Comment - if needed, added by user</span>
    <span class="n">_comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Comment - if needed, added by user&quot;&quot;&quot;</span>
    <span class="c1">## TTree creation date/time in UTC - a naive time, without timezone set</span>
    <span class="n">_creation_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TTree creation date/time in UTC - a naive time, without timezone set&quot;&quot;&quot;</span>
    <span class="c1">## Modification history - JSON</span>
    <span class="n">_modification_history</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Modification history - JSON&quot;&quot;&quot;</span>

    <span class="c1">## Fields that are not branches</span>
    <span class="n">_nonbranch_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;_nonbranch_fields&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_tree&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_file&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_file_name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_tree_name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_cur_du_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_entry_list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_attributes_and_properties&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_comment&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_creation_datetime&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_modification_software&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_modification_software_version&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_source_datetime&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_analysis_level&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_modification_history&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__setattr__&quot;</span>
    <span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fields that are not branches&quot;&quot;&quot;</span>

    <span class="c1"># def __setattr__(self, key, value):</span>
<div class="viewcode-block" id="DataTree.mod_setattr">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.mod_setattr">[docs]</a>
    <span class="k">def</span> <span class="nf">mod_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># Create a list of attributes and properties for the class if it doesn&#39;t exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_attributes_and_properties&quot;</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_attributes_and_properties&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">([</span><span class="n">el1</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">el1</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="vm">__annotations__</span><span class="o">.</span><span class="n">keys</span><span class="p">())]))</span>
        <span class="c1"># If the attribute not in the list of class&#39;s attributes and properties, don&#39;t add it</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_and_properties</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> attribute for class </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> doesn&#39;t exist.&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The ROOT TTree in which the variables&#39; values are stored&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The type of the tree&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>

    <span class="nd">@type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># The meta field does not exist, add it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">:=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TNamed</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="c1"># The meta field exists, change the value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="c1"># Update the property</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The ROOT TFile in which the tree is stored&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span>

    <span class="nd">@file</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_file</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tree_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The name of the TTree&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span>

    <span class="nd">@tree_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tree_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the tree name&quot;&quot;&quot;</span>
        <span class="c1"># ToDo: enforce the name to start with the type!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The file in which the TTree is stored&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Comment - if needed, added by user&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span>

    <span class="nd">@comment</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># The meta field does not exist, add it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">:=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TNamed</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="c1"># The meta field exists, change the value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="c1"># Update the property</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">creation_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_datetime</span>

    <span class="nd">@creation_datetime</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">creation_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># If datetime was given, convert it to int</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
            <span class="n">val_dt</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">val_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2"> for creation_datetime!&quot;</span><span class="p">)</span>

        <span class="c1"># The meta field does not exist, add it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">el</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;creation_datetime&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TParameter</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="s2">&quot;creation_datetime&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="c1"># The meta field exists, change the value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">SetVal</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_creation_datetime</span> <span class="o">=</span> <span class="n">val_dt</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modification_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modification_history - if needed, added by user&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modification_history</span>

    <span class="nd">@modification_history</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">modification_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># The meta field does not exist, add it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">:=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;modification_history&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TNamed</span><span class="p">(</span><span class="s2">&quot;modification_history&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="c1"># The meta field exists, change the value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="c1"># Update the property</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modification_history</span> <span class="o">=</span> <span class="n">val</span>

<div class="viewcode-block" id="DataTree.get_default_tree_name">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_default_tree_name">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_default_tree_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the default name of the tree of the class&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_tree_name</span></div>


    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="c1"># Append the instance to the list of generated trees - needed later for adding friends</span>
        <span class="n">grand_tree_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Init _file from TFile object</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
        <span class="c1"># or init _file from a name string</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span>

        <span class="c1"># Init tree from the name string</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="p">)</span>
        <span class="c1"># or create the tree</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_tree</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">StdVectorList</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;not set for&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_setattr</span>

    <span class="c1">## Return the iterable over self</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the iterable over self&quot;&quot;&quot;</span>
        <span class="c1"># Always start the iteration with the first entry</span>
        <span class="n">current_entry</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">current_entry</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_entry</span><span class="p">(</span><span class="n">current_entry</span><span class="p">)</span>
            <span class="k">yield</span> <span class="bp">self</span>
            <span class="n">current_entry</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1">## Set the tree&#39;s file</span>
    <span class="k">def</span> <span class="nf">_set_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the tree&#39;s file&quot;&quot;&quot;</span>
        <span class="c1"># If the ROOT TFile is given, just use it</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">f</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
        <span class="c1"># If the filename string is given, open/create the ROOT file with this name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">=</span> <span class="n">f</span>
            <span class="c1"># print(self._file_name)</span>
            <span class="c1"># If the file with that filename is already opened, use it (do not reopen)</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">:=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">gROOT</span><span class="o">.</span><span class="n">GetListOfFiles</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">f</span>
            <span class="c1"># If not opened, open</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If file exists, initially open in the read-only mode (changed during write())</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span>
                <span class="c1"># If the file does not exist, create it</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">)</span>

    <span class="c1">## Init/readout the tree from a file</span>
    <span class="k">def</span> <span class="nf">_set_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Init/readout the tree from a file&quot;&quot;&quot;</span>
        <span class="c1"># If the ROOT TTree is given, just use it</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TTree</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="n">t</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
        <span class="c1"># If the tree name string is given, open/create the ROOT TTree with this name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span> <span class="o">=</span> <span class="n">t</span>

            <span class="c1"># Try to init with the TTree from file</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>
                <span class="c1"># There was no such tree in the file, so create one</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No valid </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="si">}</span><span class="s2"> TTree in the file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span><span class="si">}</span><span class="s2">. Creating a new one.&quot;</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_create_tree</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;creating tree </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_tree</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assign_metadata</span><span class="p">()</span>

        <span class="c1"># Fill the runs/events numbers from the tree (important if it already existed)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_entry_list</span><span class="p">()</span>

    <span class="c1">## Create the tree</span>
    <span class="k">def</span> <span class="nf">_create_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the tree&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tree_name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span> <span class="o">=</span> <span class="n">tree_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_metadata</span><span class="p">()</span>

<div class="viewcode-block" id="DataTree.fill">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.fill">[docs]</a>
    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds the current variable values as a new event to the tree&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="DataTree.write">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">close_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_close_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the tree to the file&quot;&quot;&quot;</span>
        <span class="c1"># Add the tree friends to this tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_proper_friends</span><span class="p">()</span>

        <span class="c1"># If string is ending with &quot;.root&quot; given as a first argument, create the TFile</span>
        <span class="c1"># ToDo: Handle TFile if added as the argument</span>
        <span class="n">creating_file</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;.root&quot;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># The TFile object is already in memory, just use it</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">:=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">gROOT</span><span class="o">.</span><span class="n">GetListOfFiles</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">f</span>
                <span class="c1"># File exists, but reopen the file in the update mode in case it was read only</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">ReOpen</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
            <span class="c1"># Create a new TFile object</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">creating_file</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Overwrite requested</span>
                <span class="c1"># ToDo: this does not really seem to work now</span>
                <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;recreate&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># By default append</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;update&quot;</span><span class="p">)</span>
            <span class="c1"># Make the tree save itself in this file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
            <span class="c1"># args passed to the TTree::Write() should be the following</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># File exists, so reopen the file in the update mode in case it was read only</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">ReOpen</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>

        <span class="c1"># ToDo: For now, I don&#39;t know how to do that: Check if the entries in possible tree in the file do not already contain entries from the current tree</span>

        <span class="c1"># If the writing options are not explicitly specified, add kWriteDelete option, that deletes the old cycle after writing the new cycle in the TFile</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TObject</span><span class="o">.</span><span class="n">kWriteDelete</span><span class="p">]</span>
        <span class="c1"># ToDo: make sure that the tree has different name than the trees existing in the file!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="c1"># If TFile was created here, close it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">creating_file</span> <span class="ow">and</span> <span class="n">close_file</span><span class="p">)</span> <span class="ow">or</span> <span class="n">force_close_file</span><span class="p">:</span>
            <span class="c1"># Need to set 0 directory so that closing of the file does not delete the internal TTree</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetDirectory</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">nullptr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span></div>


    <span class="c1">## Fills the entry list from the tree</span>
<div class="viewcode-block" id="DataTree.fill_entry_list">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.fill_entry_list">[docs]</a>
    <span class="k">def</span> <span class="nf">fill_entry_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fills the entry list from the tree&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


    <span class="c1">## Check if specified run_number/event_number already exist in the tree</span>
<div class="viewcode-block" id="DataTree.is_unique_event">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.is_unique_event">[docs]</a>
    <span class="k">def</span> <span class="nf">is_unique_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if specified run_number/event_number already exist in the tree&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


    <span class="c1">## Add the proper friend trees to this tree (reimplemented in daughter classes)</span>
<div class="viewcode-block" id="DataTree.add_proper_friends">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.add_proper_friends">[docs]</a>
    <span class="k">def</span> <span class="nf">add_proper_friends</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the proper friend trees to this tree (reimplemented in daughter classes)&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="DataTree.scan">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.scan">[docs]</a>
    <span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print out the values of the specified members of the tree (TTree::Scan() interface)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Scan</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataTree.get_entry">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_entry">[docs]</a>
    <span class="k">def</span> <span class="nf">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev_no</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read into memory the ev_no entry of the tree&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetEntry</span><span class="p">(</span><span class="n">ev_no</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign_branches</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="DataTree.draw">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varexp</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">nentries</span><span class="o">=</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TTree</span><span class="o">.</span><span class="n">kMaxEntries</span><span class="p">,</span> <span class="n">firstentry</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An interface to TTree::Draw(). Allows for drawing specific TTree columns or getting their values with get_vX().&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">varexp</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">nentries</span><span class="p">,</span> <span class="n">firstentry</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataTree.get_v1">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_v1">[docs]</a>
    <span class="k">def</span> <span class="nf">get_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get first vector of results from draw()&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV1</span><span class="p">()</span></div>


<div class="viewcode-block" id="DataTree.get_v2">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_v2">[docs]</a>
    <span class="k">def</span> <span class="nf">get_v2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get second vector of results from draw()&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV2</span><span class="p">()</span></div>


<div class="viewcode-block" id="DataTree.get_v3">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_v3">[docs]</a>
    <span class="k">def</span> <span class="nf">get_v3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get third vector of results from draw()&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV3</span><span class="p">()</span></div>


<div class="viewcode-block" id="DataTree.get_v4">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_v4">[docs]</a>
    <span class="k">def</span> <span class="nf">get_v4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get fourth vector of results from draw()&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV4</span><span class="p">()</span></div>


    <span class="c1">## All three methods below return the number of entries</span>
<div class="viewcode-block" id="DataTree.get_entries">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_entries">[docs]</a>
    <span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of events in the tree&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">()</span></div>


<div class="viewcode-block" id="DataTree.get_number_of_entries">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_number_of_entries">[docs]</a>
    <span class="k">def</span> <span class="nf">get_number_of_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of events in the tree&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entries</span><span class="p">()</span></div>


<div class="viewcode-block" id="DataTree.get_number_of_events">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_number_of_events">[docs]</a>
    <span class="k">def</span> <span class="nf">get_number_of_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of events in the tree&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_entries</span><span class="p">()</span></div>


<div class="viewcode-block" id="DataTree.add_friend">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.add_friend">[docs]</a>
    <span class="k">def</span> <span class="nf">add_friend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="c1"># ToDo: Due to a bug discovered during DC1, disable adding of the friends for now</span>
        <span class="k">return</span> <span class="mi">0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a friend to the tree&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">AddFriend</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataTree.remove_friend">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.remove_friend">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_friend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a friend from the tree&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">RemoveFriend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataTree.set_tree_index">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.set_tree_index">[docs]</a>
    <span class="k">def</span> <span class="nf">set_tree_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the tree index (necessary for working with friends)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetTreeIndex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


    <span class="c1">## Create branches of the TTree based on the class fields</span>
<div class="viewcode-block" id="DataTree.create_branches">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.create_branches">[docs]</a>
    <span class="k">def</span> <span class="nf">create_branches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_if_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create branches of the TTree based on the class fields&quot;&quot;&quot;</span>
        <span class="c1"># Reset all branch addresses just in case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">ResetBranchAddresses</span><span class="p">()</span>

        <span class="c1"># If branches already exist, set their address instead of creating, if requested</span>
        <span class="n">set_branches</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">set_if_exists</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetListOfBranches</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">set_branches</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Loop through the class fields</span>
        <span class="c1"># for field in self.__dataclass_fields__:</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="c1"># Skip fields that are not the part of the stored data</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonbranch_fields</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Create a branch for the field</span>
            <span class="c1"># print(field, self.__dict__[field], type(self.__dict__[field]))</span>
            <span class="c1"># self.create_branch_from_field(self.__dataclass_fields__[field], set_branches)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_branch_from_field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">set_branches</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span></div>


    <span class="c1">## Create a specific branch of a TTree computing its type from the corresponding class field</span>
<div class="viewcode-block" id="DataTree.create_branch_from_field">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.create_branch_from_field">[docs]</a>
    <span class="k">def</span> <span class="nf">create_branch_from_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">set_branches</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a specific branch of a TTree computing its type from the corresponding class field&quot;&quot;&quot;</span>
        <span class="c1"># Handle numpy arrays</span>
        <span class="c1"># for key in dir(value):</span>
        <span class="c1">#     print(getattr(value, key))</span>

        <span class="c1"># Not all values start with _</span>
        <span class="n">branch_name</span> <span class="o">=</span> <span class="n">value_name</span>
        <span class="k">if</span> <span class="n">value_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="n">branch_name</span> <span class="o">=</span> <span class="n">value_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># Generate ROOT TTree data type string</span>

            <span class="c1"># If the value is a (1D) numpy array with more than 1 value, make it an (1D) array in ROOT</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="c1"># Data type</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/B&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/b&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/S&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/s&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/I&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/i&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/L&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/l&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/F&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/D&quot;</span>
            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">:</span>
                <span class="n">val_type</span> <span class="o">+=</span> <span class="s2">&quot;/O&quot;</span>

            <span class="c1"># Create the branch</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_branches</span><span class="p">:</span>
                <span class="c1"># self._tree.Branch(value_name[1:], getattr(self, value_name), value_name[1:] + val_type)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Branch</span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">),</span> <span class="n">branch_name</span> <span class="o">+</span> <span class="n">val_type</span><span class="p">)</span>
            <span class="c1"># Or set its address</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># self._tree.SetBranchAddress(value_name[1:], getattr(self, value_name))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetBranchAddress</span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">))</span>
        <span class="c1"># ROOT vectors as StdVectorList</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">StdVectorList</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">StdVectorListDesc</span><span class="p">:</span>
            <span class="c1"># Create the branch</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_branches</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Branch</span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">)</span><span class="o">.</span><span class="n">_vector</span><span class="p">)</span>
            <span class="c1"># Or set its address</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Try to attach the branch from the tree</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># self._tree.SetBranchAddress(value_name[1:], getattr(self, value_name)._vector)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetBranchAddress</span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">)</span><span class="o">.</span><span class="n">_vector</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># logger.warning(f&quot;Could not find branch {value_name[1:]} in tree {self.tree_name}. This branch will not be filled.&quot;)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find branch </span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2"> in tree </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_name</span><span class="si">}</span><span class="s2">. This branch will not be filled.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">StdString</span><span class="p">:</span>
            <span class="c1"># Create the branch</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_branches</span><span class="p">:</span>
                <span class="c1"># self._tree.Branch(value.name[1:], getattr(self, value.name).string)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Branch</span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">)</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
            <span class="c1"># Or set its address</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># self._tree.SetBranchAddress(value.name[1:], getattr(self, value.name).string)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetBranchAddress</span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">)</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">string</span><span class="p">):</span>
            <span class="c1"># Create the branch</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_branches</span><span class="p">:</span>
                <span class="c1"># self._tree.Branch(value.name[1:], getattr(self, value.name).string)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Branch</span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">))</span>
            <span class="c1"># Or set its address</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># self._tree.SetBranchAddress(value.name[1:], getattr(self, value.name).string)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetBranchAddress</span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">. Can&#39;t create a branch.&quot;</span><span class="p">)</span></div>


    <span class="c1">## Assign branches to the instance - without calling it, the instance does not show the values read to the TTree</span>
<div class="viewcode-block" id="DataTree.assign_branches">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.assign_branches">[docs]</a>
    <span class="k">def</span> <span class="nf">assign_branches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign branches to the instance - without calling it, the instance does not show the values read to the TTree&quot;&quot;&quot;</span>
        <span class="c1"># Assign the TTree branches to the class fields</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="p">:</span>
            <span class="c1"># Skip fields that are not the part of the stored data</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonbranch_fields</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="n">field</span>
            <span class="k">if</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span> <span class="n">field_name</span><span class="o">=</span><span class="n">field</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="c1"># print(field, self.__dataclass_fields__[field])</span>
            <span class="c1"># Read the TTree branch</span>
            <span class="n">u</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
            <span class="c1"># print(&quot;*&quot;, field[1:], self.__dataclass_fields__[field].name, u, type(u), id(u))</span>
            <span class="c1"># Assign the TTree branch value to the class field</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span></div>


    <span class="c1">## Create metadata for the tree</span>
<div class="viewcode-block" id="DataTree.create_metadata">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.create_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">create_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create metadata for the tree&quot;&quot;&quot;</span>
        <span class="c1"># ToDo: stupid, because default values are generated here and in the class fields definitions. But definition of the class field does not call the setter, which is needed to attach these fields to the tree.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modification_history</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>


    <span class="c1">## Assign metadata to the instance - without calling it, the instance does not show the metadata stored in the TTree</span>
<div class="viewcode-block" id="DataTree.assign_metadata">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.assign_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">assign_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign metadata to the instance - without calling it, the instance does not show the metadata stored in the TTree&quot;&quot;&quot;</span>
        <span class="n">metadata_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">metadata_count</span><span class="p">):</span>
            <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">At</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># meta as TNamed</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TNamed</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">GetName</span><span class="p">(),</span> <span class="n">el</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">())</span>
            <span class="c1"># meta as TParameter</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">GetName</span><span class="p">(),</span> <span class="n">el</span><span class="o">.</span><span class="n">GetVal</span><span class="p">())</span></div>


    <span class="c1">## Get entry with indices</span>
<div class="viewcode-block" id="DataTree.get_entry_with_index">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_entry_with_index">[docs]</a>
    <span class="k">def</span> <span class="nf">get_entry_with_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_no</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">evt_no</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the event with run_no and evt_no&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetEntryWithIndex</span><span class="p">(</span><span class="n">run_no</span><span class="p">,</span> <span class="n">evt_no</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No event with event number </span><span class="si">{</span><span class="n">evt_no</span><span class="si">}</span><span class="s2"> and run number </span><span class="si">{</span><span class="n">run_no</span><span class="si">}</span><span class="s2"> in the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_name</span><span class="si">}</span><span class="s2"> tree. Please provide proper numbers.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assign_branches</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span></div>


    <span class="c1">## Print out the tree scheme</span>
<div class="viewcode-block" id="DataTree.print">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.print">[docs]</a>
    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print out the tree scheme&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span></div>


    <span class="c1">## Print the meta information</span>
<div class="viewcode-block" id="DataTree.print_metadata">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.print_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">print_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the meta information&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">GetVal</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">()</span>
                <span class="c1"># Add &quot;&quot; to the string to show it is a string</span>
                <span class="n">val</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">el</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataTree.get_metadata_as_dict">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_metadata_as_dict">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_metadata_as_dict</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the meta information as a dictionary&quot;&quot;&quot;</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">GetVal</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">()</span>

            <span class="c1"># Convert unix time if this is the datetime</span>
            <span class="k">if</span> <span class="s2">&quot;datetime&quot;</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="ow">and</span> <span class="n">val</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="n">metadata</span><span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">GetName</span><span class="p">()]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="k">return</span> <span class="n">metadata</span></div>


    <span class="c1">## Copy contents of another dataclass instance of the same type to this instance</span>
<div class="viewcode-block" id="DataTree.copy_contents">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.copy_contents">[docs]</a>
    <span class="k">def</span> <span class="nf">copy_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy contents of another dataclass instance of similar type to this instance</span>
<span class="sd">        The source has to have some field the same as this tree. For example EventEfieldTree and EventVoltageTree&quot;&quot;&quot;</span>
        <span class="c1"># ToDo: Shallow copy with assigning branches would be probably faster, but it would be... shallow ;)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Skip the nonbranch fields and fields not belonging to this tree type</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonbranch_fields</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The type of </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">tree_name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="si">}</span><span class="s2"> differs. Not copying.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataTree.get_tree_size">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.get_tree_size">[docs]</a>
    <span class="k">def</span> <span class="nf">get_tree_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the tree size in memory and on disk, similar to what comes from the Print()&quot;&quot;&quot;</span>
        <span class="n">mem_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span><span class="o">.</span><span class="n">GetKey</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span><span class="o">.</span><span class="n">GetKeylen</span><span class="p">()</span>
        <span class="n">mem_size</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetTotBytes</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TBufferFile</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TBuffer</span><span class="o">.</span><span class="n">kWrite</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">IsA</span><span class="p">()</span><span class="o">.</span><span class="n">WriteBuffer</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="p">)</span>
        <span class="n">mem_size</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">Length</span><span class="p">()</span>

        <span class="n">disk_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetZipBytes</span><span class="p">()</span>
        <span class="n">disk_size</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span><span class="o">.</span><span class="n">GetKey</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span><span class="o">.</span><span class="n">GetNbytes</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">mem_size</span><span class="p">,</span> <span class="n">disk_size</span></div>


<div class="viewcode-block" id="DataTree.close_file">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataTree.close_file">[docs]</a>
    <span class="k">def</span> <span class="nf">close_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the file associated to the tree&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span></div>
</div>



<span class="c1">## A mother class for classes with Run values</span>
<div class="viewcode-block" id="MotherRunTree">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherRunTree">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MotherRunTree</span><span class="p">(</span><span class="n">DataTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A mother class for classes with Run values&quot;&quot;&quot;</span>

    <span class="n">run_number</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>

<div class="viewcode-block" id="MotherRunTree.fill">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherRunTree.fill">[docs]</a>
    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds the current variable values as a new event to the tree&quot;&quot;&quot;</span>
        <span class="c1"># If the current run_number and event_number already exist, raise an exception</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_unique_event</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotUniqueEvent</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A run with run_number=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_number</span><span class="si">}</span><span class="s2"> already exists in the TTree.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Repoen the file in write mode, if it exists</span>
        <span class="c1"># Reopening in case of different mode takes here ~0.06 s, in case of the same mode, 0.0005 s, so negligible</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">ReOpen</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>

        <span class="c1"># Fill the tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Fill</span><span class="p">()</span>

        <span class="c1"># Add the current run_number and event_number to the entry_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_number</span><span class="p">)</span></div>


<div class="viewcode-block" id="MotherRunTree.add_proper_friends">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherRunTree.add_proper_friends">[docs]</a>
    <span class="k">def</span> <span class="nf">add_proper_friends</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add proper friends to this tree&quot;&quot;&quot;</span>
        <span class="c1"># Create the indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">BuildIndex</span><span class="p">(</span><span class="s2">&quot;run_number&quot;</span><span class="p">)</span></div>


    <span class="c1">## List runs in the tree</span>
<div class="viewcode-block" id="MotherRunTree.print_list_of_runs">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherRunTree.print_list_of_runs">[docs]</a>
    <span class="k">def</span> <span class="nf">print_list_of_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List runs in the tree&quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;run_number&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;goff&quot;</span><span class="p">)</span>
        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV1</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of runs in the tree:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span></div>


    <span class="c1">## Gets list of runs in the tree together</span>
<div class="viewcode-block" id="MotherRunTree.get_list_of_runs">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherRunTree.get_list_of_runs">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list_of_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets list of runs in the tree together&quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;run_number&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;goff&quot;</span><span class="p">)</span>
        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV1</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)]</span></div>


    <span class="c1"># Readout the TTree entry corresponding to the run</span>
<div class="viewcode-block" id="MotherRunTree.get_run">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherRunTree.get_run">[docs]</a>
    <span class="k">def</span> <span class="nf">get_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_no</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Readout the TTree entry corresponding to the run&quot;&quot;&quot;</span>
        <span class="c1"># Make sure we have an int</span>
        <span class="n">run_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">run_no</span><span class="p">)</span>
        <span class="c1"># Try to get the run from the tree</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetEntryWithIndex</span><span class="p">(</span><span class="n">run_no</span><span class="p">)</span>
        <span class="c1"># If no such entry, return</span>
        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No run with run number </span><span class="si">{</span><span class="n">run_no</span><span class="si">}</span><span class="s2">. Please provide a proper number.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assign_branches</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="MotherRunTree.build_index">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherRunTree.build_index">[docs]</a>
    <span class="k">def</span> <span class="nf">build_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the tree index (necessary for working with friends)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">BuildIndex</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span></div>


    <span class="c1">## Fills the entry list from the tree</span>
<div class="viewcode-block" id="MotherRunTree.fill_entry_list">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherRunTree.fill_entry_list">[docs]</a>
    <span class="k">def</span> <span class="nf">fill_entry_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fills the entry list from the tree&quot;&quot;&quot;</span>
        <span class="c1"># Fill the entry list if there are some entries in the tree</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;run_number&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;goff&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV1</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">v1</span><span class="p">]</span></div>


    <span class="c1">## Check if specified run_number/event_number already exist in the tree</span>
<div class="viewcode-block" id="MotherRunTree.is_unique_event">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherRunTree.is_unique_event">[docs]</a>
    <span class="k">def</span> <span class="nf">is_unique_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if specified run_number/event_number already exist in the tree&quot;&quot;&quot;</span>
        <span class="c1"># If the entry list does not exist, the event is unique</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_list</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>
</div>



<span class="c1">## A mother class for classes with Event values</span>
<div class="viewcode-block" id="MotherEventTree">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MotherEventTree</span><span class="p">(</span><span class="n">DataTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A mother class for classes with Event values&quot;&quot;&quot;</span>

    <span class="n">run_number</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
    <span class="c1"># ToDo: it seems instances propagate this number among them without setting (but not the run number!). I should find why...</span>
    <span class="n">event_number</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>

    <span class="c1">## Unix creation datetime of the source tree; 0 s means no source</span>
    <span class="n">_source_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix creation datetime of the source tree; 0 s means no source&quot;&quot;&quot;</span>
    <span class="c1">## The tool used to generate this tree&#39;s values from another tree</span>
    <span class="n">_modification_software</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The tool used to generate this tree&#39;s values from another tree&quot;&quot;&quot;</span>
    <span class="c1">## The version of the tool used to generate this tree&#39;s values from another tree</span>
    <span class="n">_modification_software_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The version of the tool used to generate this tree&#39;s values from another tree&quot;&quot;&quot;</span>
    <span class="c1">## The analysis level of this tree</span>
    <span class="n">_analysis_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The analysis level of this tree&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unix creation datetime of the source tree; 0 s means no source&quot;&quot;&quot;</span>
        <span class="c1"># Convert from ROOT&#39;s TDatime into Python&#39;s datetime object</span>
        <span class="c1"># return datetime.datetime.fromtimestamp(self._tree.GetUserInfo().At(3).GetVal())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_datetime</span>

    <span class="nd">@source_datetime</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">source_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Remove the existing datetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;source_datetime&quot;</span><span class="p">))</span>

        <span class="c1"># If datetime was given</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
            <span class="n">val_dt</span> <span class="o">=</span> <span class="n">val</span>
        <span class="c1"># If timestamp was given - this happens when initialising with self.assign_metadata()</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">val_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2"> for source_datetime!&quot;</span><span class="p">)</span>

        <span class="c1"># The meta field does not exist, add it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">:=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;source_datetime&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TParameter</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="s2">&quot;source_datetime&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="c1"># The meta field exists, change the value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">SetVal</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_source_datetime</span> <span class="o">=</span> <span class="n">val_dt</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modification_software</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The tool used to generate this tree&#39;s values from another tree&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modification_software</span>

    <span class="nd">@modification_software</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">modification_software</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># The meta field does not exist, add it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">:=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;modification_software&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TNamed</span><span class="p">(</span><span class="s2">&quot;modification_software&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="c1"># The meta field exists, change the value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_modification_software</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modification_software_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The tool used to generate this tree&#39;s values from another tree&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modification_software_version</span>

    <span class="nd">@modification_software_version</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">modification_software_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># The meta field does not exist, add it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">:=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;modification_software_version&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TNamed</span><span class="p">(</span><span class="s2">&quot;modification_software_version&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="c1"># The meta field exists, change the value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_modification_software_version</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">analysis_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The analysis level of this tree&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_level</span>

    <span class="nd">@analysis_level</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">analysis_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># The meta field does not exist, add it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">:=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ROOT</span><span class="o">.</span><span class="n">TParameter</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="c1"># The meta field exists, change the value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">SetVal</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_analysis_level</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_branches</span><span class="p">()</span>

    <span class="c1">## Create metadata for the tree</span>
<div class="viewcode-block" id="MotherEventTree.create_metadata">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.create_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">create_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create metadata for the tree&quot;&quot;&quot;</span>
        <span class="c1"># First add the medatata of the mother class</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">create_metadata</span><span class="p">()</span>
        <span class="c1"># ToDo: stupid, because default values are generated here and in the class fields definitions. But definition of the class field does not call the setter, which is needed to attach these fields to the tree.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modification_software</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modification_software_version</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_level</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="MotherEventTree.fill">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.fill">[docs]</a>
    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds the current variable values as a new event to the tree&quot;&quot;&quot;</span>
        <span class="c1"># If the current run_number and event_number already exist, raise an exception</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_unique_event</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotUniqueEvent</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;An event with (run_number,event_number)=(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_number</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_number</span><span class="si">}</span><span class="s2">) already exists in the TTree </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Repoen the file in write mode, if it exists</span>
        <span class="c1"># Reopening in case of different mode takes here ~0.06 s, in case of the same mode, 0.0005 s, so negligible</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">ReOpen</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>

        <span class="c1"># Fill the tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Fill</span><span class="p">()</span>

        <span class="c1"># Add the current run_number and event_number to the entry_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">run_number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_number</span><span class="p">))</span></div>


<div class="viewcode-block" id="MotherEventTree.add_proper_friends">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.add_proper_friends">[docs]</a>
    <span class="k">def</span> <span class="nf">add_proper_friends</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add proper friends to this tree&quot;&quot;&quot;</span>
        <span class="c1"># Create the indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_index</span><span class="p">(</span><span class="s2">&quot;run_number&quot;</span><span class="p">,</span> <span class="s2">&quot;event_number&quot;</span><span class="p">)</span>

        <span class="c1"># Add the Run tree as a friend if exists already</span>
        <span class="n">loc_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
        <span class="n">run_trees</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">grand_tree_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TRun</span><span class="p">:</span>
                <span class="n">run_trees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="c1"># If any Run tree was found</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Warning if there is more than 1 TRun in memory</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;More than 1 TRun detected in memory. Adding the last one </span><span class="si">{</span><span class="n">run_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> as a friend&quot;</span>
                <span class="p">)</span>
            <span class="c1"># Add the last one TRun as a friend</span>
            <span class="n">run_tree</span> <span class="o">=</span> <span class="n">run_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Add the Run TTree as a friend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="n">run_tree</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">run_tree</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># Do not add TADC as a friend to itself</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TADC</span><span class="p">):</span>
            <span class="c1"># Add the ADC tree as a friend if exists already</span>
            <span class="n">adc_trees</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">grand_tree_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TADC</span><span class="p">:</span>
                    <span class="n">adc_trees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
            <span class="c1"># If any ADC tree was found</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">adc_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Warning if there is more than 1 TADC in memory</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">adc_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;More than 1 TADC detected in memory. Adding the last one </span><span class="si">{</span><span class="n">adc_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> as a friend&quot;</span>
                    <span class="p">)</span>
                <span class="c1"># Add the last one TADC as a friend</span>
                <span class="n">adc_tree</span> <span class="o">=</span> <span class="n">adc_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Add the ADC TTree as a friend</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="n">adc_tree</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">adc_tree</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># Do not add TRawVoltage as a friend to itself</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TRawVoltage</span><span class="p">):</span>
            <span class="c1"># Add the Voltage tree as a friend if exists already</span>
            <span class="n">voltage_trees</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">grand_tree_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TRawVoltage</span><span class="p">:</span>
                    <span class="n">voltage_trees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
            <span class="c1"># If any voltage tree was found</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">voltage_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Warning if there is more than 1 TRawVoltage in memory</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">voltage_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;More than 1 TRawVoltage detected in memory. Adding the last one </span><span class="si">{</span><span class="n">voltage_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> as a friend&quot;</span>
                    <span class="p">)</span>
                <span class="c1"># Add the last one TRawVoltage as a friend</span>
                <span class="n">voltage_tree</span> <span class="o">=</span> <span class="n">voltage_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Add the Voltage TTree as a friend</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="n">voltage_tree</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">voltage_tree</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># Do not add TEfield as a friend to itself</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TEfield</span><span class="p">):</span>
            <span class="c1"># Add the Efield tree as a friend if exists already</span>
            <span class="n">efield_trees</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">grand_tree_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TEfield</span><span class="p">:</span>
                    <span class="n">efield_trees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
            <span class="c1"># If any Efield tree was found</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">efield_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Warning if there is more than 1 TEfield in memory</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">efield_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;More than 1 TEfield detected in memory. Adding the last one </span><span class="si">{</span><span class="n">efield_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> as a friend&quot;</span>
                    <span class="p">)</span>
                <span class="c1"># Add the last one TEfield as a friend</span>
                <span class="n">efield_tree</span> <span class="o">=</span> <span class="n">efield_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Add the Efield TTree as a friend</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="n">efield_tree</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">efield_tree</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># Do not add TShower as a friend to itself</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TShower</span><span class="p">):</span>
            <span class="c1"># Add the Shower tree as a friend if exists already</span>
            <span class="n">shower_trees</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">grand_tree_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TShower</span><span class="p">:</span>
                    <span class="n">shower_trees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
            <span class="c1"># If any Shower tree was found</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shower_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Warning if there is more than 1 TShower in memory</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shower_trees</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;More than 1 TShower detected in memory. Adding the last one </span><span class="si">{</span><span class="n">shower_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> as a friend&quot;</span>
                    <span class="p">)</span>
                <span class="c1"># Add the last one TShower as a friend</span>
                <span class="n">shower_tree</span> <span class="o">=</span> <span class="n">shower_trees</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Add the Shower TTree as a friend</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="n">shower_tree</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">shower_tree</span><span class="o">.</span><span class="n">file</span><span class="p">)</span></div>


    <span class="c1">## List events in the tree together with runs</span>
<div class="viewcode-block" id="MotherEventTree.print_list_of_events">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.print_list_of_events">[docs]</a>
    <span class="k">def</span> <span class="nf">print_list_of_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List events in the tree together with runs&quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;event_number:run_number&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;goff&quot;</span><span class="p">)</span>
        <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV1</span><span class="p">()</span>
        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV2</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of events in the tree:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;event_number run_number&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span></div>


    <span class="c1">## Gets list of events in the tree together with runs</span>
<div class="viewcode-block" id="MotherEventTree.get_list_of_events">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.get_list_of_events">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list_of_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets list of events in the tree together with runs&quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;event_number:run_number&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;goff&quot;</span><span class="p">)</span>
        <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV1</span><span class="p">()</span>
        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV2</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)]</span></div>


    <span class="c1">## Readout the TTree entry corresponding to the event and run</span>
<div class="viewcode-block" id="MotherEventTree.get_event">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.get_event">[docs]</a>
    <span class="k">def</span> <span class="nf">get_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev_no</span><span class="p">,</span> <span class="n">run_no</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Readout the TTree entry corresponding to the event and run&quot;&quot;&quot;</span>
        <span class="c1"># Try to get the requested entry</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetEntryWithIndex</span><span class="p">(</span><span class="n">run_no</span><span class="p">,</span> <span class="n">ev_no</span><span class="p">)</span>
        <span class="c1"># If no such entry, return</span>
        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No event with event number </span><span class="si">{</span><span class="n">ev_no</span><span class="si">}</span><span class="s2"> and run number </span><span class="si">{</span><span class="n">run_no</span><span class="si">}</span><span class="s2"> in the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_name</span><span class="si">}</span><span class="s2"> tree. Please provide proper numbers.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assign_branches</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">res</span></div>


    <span class="c1">## Builds index based on run_id and evt_id for the TTree</span>
<div class="viewcode-block" id="MotherEventTree.build_index">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.build_index">[docs]</a>
    <span class="k">def</span> <span class="nf">build_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">evt_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds index based on run_id and evt_id for the TTree&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">BuildIndex</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">evt_id</span><span class="p">)</span></div>


    <span class="c1">## Fills the entry list from the tree</span>
<div class="viewcode-block" id="MotherEventTree.fill_entry_list">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.fill_entry_list">[docs]</a>
    <span class="k">def</span> <span class="nf">fill_entry_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fills the entry list from the tree&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span>
        <span class="c1"># Fill the entry list if there are some entries in the tree</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">:=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;run_number:event_number&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;goff&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">GetV1</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">GetV2</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry_list</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)]</span></div>


    <span class="c1">## Check if specified run_number/event_number already exist in the tree</span>
<div class="viewcode-block" id="MotherEventTree.is_unique_event">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.is_unique_event">[docs]</a>
    <span class="k">def</span> <span class="nf">is_unique_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if specified run_number/event_number already exist in the tree&quot;&quot;&quot;</span>
        <span class="c1"># If the entry list does not exist, the event is unique</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_list</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_number</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="MotherEventTree.get_traces_lengths">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.get_traces_lengths">[docs]</a>
    <span class="k">def</span> <span class="nf">get_traces_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the traces lengths for each event&quot;&quot;&quot;</span>

        <span class="c1"># If there are no traces in the tree, return None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetListOfLeaves</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;trace_x&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetListOfLeaves</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;trace_0&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">traces_lengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># For ADC traces - 4 traces, different names</span>
        <span class="k">if</span> <span class="s2">&quot;ADC&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">or</span> <span class="s2">&quot;RawVoltage&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="n">traces_suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="c1"># Other traces</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">traces_suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]</span>

        <span class="c1"># Get sizes of each traces</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">traces_suffixes</span><span class="p">:</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@trace_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.size()&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;goff&quot;</span><span class="p">)</span>
            <span class="n">traces_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetV1</span><span class="p">(),</span> <span class="n">count</span><span class="o">=</span><span class="n">cnt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">traces_lengths</span></div>


<div class="viewcode-block" id="MotherEventTree.get_list_of_dus">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.get_list_of_dus">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list_of_dus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the list of all detector units used for each event&quot;&quot;&quot;</span>

        <span class="c1"># If there are no detector unit ids in the tree, return None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetListOfLeaves</span><span class="p">()</span><span class="o">.</span><span class="n">FindObject</span><span class="p">(</span><span class="s2">&quot;du_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Try to store the currently read entry</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetReadEntry</span><span class="p">()</span>
        <span class="c1"># if failed, store None</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">current_entry</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Get the detector units branch</span>
        <span class="n">du_br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetBranch</span><span class="p">(</span><span class="s2">&quot;du_id&quot;</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s2">&quot;du_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;goff&quot;</span><span class="p">)</span>
        <span class="n">detector_units</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_v1</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

        <span class="c1"># If there was an entry read before this action, come back to this entry</span>
        <span class="k">if</span> <span class="n">current_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">du_br</span><span class="o">.</span><span class="n">GetEntry</span><span class="p">(</span><span class="n">current_entry</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">detector_units</span></div>


<div class="viewcode-block" id="MotherEventTree.get_list_of_all_used_dus">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.MotherEventTree.get_list_of_all_used_dus">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list_of_all_used_dus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compiles the list of all detector units used in the events of the tree&quot;&quot;&quot;</span>
        <span class="n">dus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_of_dus</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dus</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>
</div>



<span class="c1">## A class wrapping around a TTree holding values common for the whole run</span>
<div class="viewcode-block" id="TRun">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TRun">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TRun</span><span class="p">(</span><span class="n">MotherRunTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class wrapping around a TTree holding values common for the whole run&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;run&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;trun&quot;</span>

    <span class="c1">## Run mode - calibration/test/physics. ToDo: should get enum description for that, but I don&#39;t think it exists at the moment</span>
    <span class="n">run_mode</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run mode - calibration/test/physics. ToDo: should get enum description for that, but I don&#39;t think it exists at the moment&quot;&quot;&quot;</span>
    <span class="c1">## Run&#39;s first event</span>
    <span class="n">first_event</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run&#39;s first event&quot;&quot;&quot;</span>
    <span class="c1">## First event time</span>
    <span class="n">first_event_time</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;First event time&quot;&quot;&quot;</span>
    <span class="c1">## Run&#39;s last event</span>
    <span class="n">last_event</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run&#39;s last event&quot;&quot;&quot;</span>
    <span class="c1">## Last event time</span>
    <span class="n">last_event_time</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Last event time&quot;&quot;&quot;</span>

    <span class="c1"># These are not from the hardware</span>
    <span class="c1">## Data source: detector, sim, other</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">(</span><span class="s2">&quot;detector&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data source: detector, sim, other&quot;&quot;&quot;</span>
    <span class="c1">## Data generator: gtot (in this case)</span>
    <span class="n">data_generator</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">(</span><span class="s2">&quot;GRANDlib&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data generator: gtot (in this case)&quot;&quot;&quot;</span>
    <span class="c1">## Generator version: gtot version (in this case)</span>
    <span class="n">data_generator_version</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">(</span><span class="s2">&quot;0.1.0&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generator version: gtot version (in this case)&quot;&quot;&quot;</span>
    <span class="c1">## Trigger type 0x1000 10 s trigger and 0x8000 random trigger, else shower</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trigger type 0x1000 10 s trigger and 0x8000 random trigger, else shower&quot;&quot;&quot;</span>
    <span class="c1">## Event format version of the DAQ</span>
    <span class="n">event_version</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Event format version of the DAQ&quot;&quot;&quot;</span>
    <span class="c1">## Site name</span>
    <span class="c1"># _site: StdVectorList(&quot;string&quot;) = StdVectorList(&quot;string&quot;)</span>
    <span class="n">site</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Site name&quot;&quot;&quot;</span>
    <span class="c1">## Site layout</span>
    <span class="n">site_layout</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Site layout&quot;&quot;&quot;</span>
    <span class="c1">## Origin of the coordinate system used for the array</span>
    <span class="n">origin_geoid</span><span class="p">:</span> <span class="n">TTreeArrayDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeArrayDesc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Origin of the coordinate system used for the array&quot;&quot;&quot;</span>

    <span class="c1">## Detector unit (antenna) ID</span>
    <span class="n">du_id</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) ID&quot;&quot;&quot;</span>
    <span class="c1">## Detector unit (antenna) (lat,lon,alt) position</span>
    <span class="n">du_geoid</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) (lat,lon,alt) position&quot;&quot;&quot;</span>
    <span class="c1">## Detector unit (antenna) (x,y,z) position in site&#39;s referential</span>
    <span class="n">du_xyz</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) (x,y,z) position in site&#39;s referential&quot;&quot;&quot;</span>
    <span class="c1">## Detector unit type</span>
    <span class="n">du_type</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit type&quot;&quot;&quot;</span>
    <span class="c1">## Detector unit (antenna) angular tilt</span>
    <span class="n">du_tilt</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) angular tilt&quot;&quot;&quot;</span>
    <span class="c1">## Angular tilt of the ground at the antenna</span>
    <span class="n">du_ground_tilt</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Angular tilt of the ground at the antenna&quot;&quot;&quot;</span>
    <span class="c1">## Detector unit (antenna) nut ID</span>
    <span class="n">du_nut</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) nut ID&quot;&quot;&quot;</span>
    <span class="c1">## Detector unit (antenna) FrontEnd Board ID</span>
    <span class="n">du_feb</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) FrontEnd Board ID&quot;&quot;&quot;</span>
    <span class="c1">## Time bin size in ns (for hardware, computed as 1/adc_sampling_frequency)</span>
    <span class="n">t_bin_size</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Time bin size in ns (for hardware, computed as 1/adc_sampling_frequency)&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_branches</span><span class="p">()</span></div>



<span class="c1">## General info on the voltage common to all events.</span>
<div class="viewcode-block" id="TRunVoltage">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TRunVoltage">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TRunVoltage</span><span class="p">(</span><span class="n">MotherRunTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;General info on the voltage common to all events.&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;runvoltage&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;trunvoltage&quot;</span>

    <span class="c1">## Control parameters - the list of general parameters that can set the mode of operation, select trigger sources and preset the common coincidence read out time window (Digitizer mode parameters in the manual).</span>
    <span class="n">digi_ctrl</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Control parameters - the list of general parameters that can set the mode of operation, select trigger sources and preset the common coincidence read out time window (Digitizer mode parameters in the manual).&quot;&quot;&quot;</span>
    <span class="c1">## Firmware version</span>
    <span class="n">firmware_version</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Firmware version&quot;&quot;&quot;</span>
    <span class="c1">## Nominal trace length in units of samples</span>
    <span class="n">trace_length</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;int&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nominal trace length in units of samples&quot;&quot;&quot;</span>
    <span class="c1">## Nominal trigger position in the trace in unit of samples</span>
    <span class="n">trigger_position</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;int&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nominal trigger position in the trace in unit of samples&quot;&quot;&quot;</span>
    <span class="c1">## ADC sampling frequency in MHz</span>
    <span class="n">adc_sampling_frequency</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC sampling frequency in MHz&quot;&quot;&quot;</span>
    <span class="c1">## ADC sampling resolution in bits</span>
    <span class="n">adc_sampling_resolution</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC sampling resolution in bits&quot;&quot;&quot;</span>
    <span class="c1">## ADC input channels - &gt; 16 BIT WORD (4*4 BITS) LOWEST IS CHANNEL 1, HIGHEST CHANNEL 4. FOR EACH CHANNEL IN THE EVENT WE HAVE: 0: ADC1, 1: ADC2, 2:ADC3, 3:ADC4 4:FILTERED ADC1, 5:FILTERED ADC 2, 6:FILTERED ADC3, 7:FILTERED ADC4. ToDo: decode this?</span>
    <span class="n">adc_input_channels</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC input channels - &gt; 16 BIT WORD (4*4 BITS) LOWEST IS CHANNEL 1, HIGHEST CHANNEL 4. FOR EACH CHANNEL IN THE EVENT WE HAVE: 0: ADC1, 1: ADC2, 2:ADC3, 3:ADC4 4:FILTERED ADC1, 5:FILTERED ADC 2, 6:FILTERED ADC3, 7:FILTERED ADC4. ToDo: decode this?&quot;&quot;&quot;</span>
    <span class="c1">## ADC enabled channels - LOWEST 4 BITS STATE WHICH CHANNEL IS READ OUT ToDo: Decode this?</span>
    <span class="n">adc_enabled_channels</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC enabled channels - LOWEST 4 BITS STATE WHICH CHANNEL IS READ OUT ToDo: Decode this?&quot;&quot;&quot;</span>
    <span class="c1">## Value of the Variable gain amplification on the board</span>
    <span class="n">gain</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;int&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Value of the Variable gain amplification on the board&quot;&quot;&quot;</span>
    <span class="c1">## Conversion factor from bits to V for ADC</span>
    <span class="n">adc_conversion</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Conversion factor from bits to V for ADC&quot;&quot;&quot;</span>
    <span class="c1">## Window parameters - describe Pre Coincidence, Coincidence and Post Coincidence readout windows (Digitizer window parameters in the manual). ToDo: Decode?</span>
    <span class="n">digi_prepost_trig_windows</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Window parameters - describe Pre Coincidence, Coincidence and Post Coincidence readout windows (Digitizer window parameters in the manual). ToDo: Decode?&quot;&quot;&quot;</span>
    <span class="c1">## Channel x properties - described in Channel property parameters in the manual. ToDo: Decode?</span>
    <span class="n">channel_properties_x</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Channel x properties - described in Channel property parameters in the manual. ToDo: Decode?&quot;&quot;&quot;</span>
    <span class="c1">## Channel y properties - described in Channel property parameters in the manual. ToDo: Decode?</span>
    <span class="n">channel_properties_y</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Channel y properties - described in Channel property parameters in the manual. ToDo: Decode?&quot;&quot;&quot;</span>
    <span class="c1">## Channel z properties - described in Channel property parameters in the manual. ToDo: Decode?</span>
    <span class="n">channel_properties_z</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Channel z properties - described in Channel property parameters in the manual. ToDo: Decode?&quot;&quot;&quot;</span>
    <span class="c1">## Channel x trigger settings - described in Channel trigger parameters in the manual. ToDo: Decode?</span>
    <span class="n">channel_trig_settings_x</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Channel x trigger settings - described in Channel trigger parameters in the manual. ToDo: Decode?&quot;&quot;&quot;</span>
    <span class="c1">## Channel y trigger settings - described in Channel trigger parameters in the manual. ToDo: Decode?</span>
    <span class="n">channel_trig_settings_y</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Channel y trigger settings - described in Channel trigger parameters in the manual. ToDo: Decode?&quot;&quot;&quot;</span>
    <span class="c1">## Channel z trigger settings - described in Channel trigger parameters in the manual. ToDo: Decode?</span>
    <span class="n">channel_trig_settings_z</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Channel z trigger settings - described in Channel trigger parameters in the manual. ToDo: Decode?&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_branches</span><span class="p">()</span></div>



<div class="viewcode-block" id="TADC">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TADC">[docs]</a>
<span class="nd">@dataclass</span>
<span class="c1">## The class for storing ADC traces and associated values for each event</span>
<span class="k">class</span> <span class="nc">TADC</span><span class="p">(</span><span class="n">MotherEventTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class for storing ADC traces and associated values for each event&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;adc&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tadc&quot;</span>

    <span class="c1">## Common for the whole event</span>
    <span class="c1">## Event size</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common for the whole event&quot;&quot;&quot;</span>
    <span class="n">event_size</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
    <span class="c1">## Event in the run number</span>
    <span class="n">t3_number</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Event in the run number&quot;&quot;&quot;</span>
    <span class="c1">## First detector unit that triggered in the event</span>
    <span class="n">first_du</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;First detector unit that triggered in the event&quot;&quot;&quot;</span>
    <span class="c1">## Unix time corresponding to the GPS seconds of the first triggered station</span>
    <span class="n">time_seconds</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time corresponding to the GPS seconds of the first triggered station&quot;&quot;&quot;</span>
    <span class="c1">## GPS nanoseconds corresponding to the trigger of the first triggered station</span>
    <span class="n">time_nanoseconds</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS nanoseconds corresponding to the trigger of the first triggered station&quot;&quot;&quot;</span>
    <span class="c1">## Trigger type 0x1000 10 s trigger and 0x8000 random trigger, else shower</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trigger type 0x1000 10 s trigger and 0x8000 random trigger, else shower&quot;&quot;&quot;</span>
    <span class="c1">## Event format version of the DAQ</span>
    <span class="n">event_version</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Event format version of the DAQ&quot;&quot;&quot;</span>
    <span class="c1">## Number of detector units in the event - basically the antennas count</span>
    <span class="n">du_count</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of detector units in the event - basically the antennas count&quot;&quot;&quot;</span>

    <span class="c1">## Specific for each Detector Unit</span>
    <span class="c1">## The T3 trigger number</span>
    <span class="n">event_id</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The T3 trigger number&quot;&quot;&quot;</span>
    <span class="c1">## Detector unit (antenna) ID</span>
    <span class="n">du_id</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) ID&quot;&quot;&quot;</span>
    <span class="c1">## Unix time of the trigger for this DU</span>
    <span class="n">du_seconds</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time of the trigger for this DU&quot;&quot;&quot;</span>
    <span class="c1">## Nanoseconds of the trigger for this DU</span>
    <span class="n">du_nanoseconds</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nanoseconds of the trigger for this DU&quot;&quot;&quot;</span>
    <span class="c1">## Trigger position in the trace (trigger start = nanoseconds - 2*sample number)</span>
    <span class="n">trigger_position</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trigger position in the trace (trigger start = nanoseconds - 2*sample number)&quot;&quot;&quot;</span>
    <span class="c1">## Same as event_type, but event_type could consist of different triggered DUs</span>
    <span class="n">trigger_flag</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Same as event_type, but event_type could consist of different triggered DUs&quot;&quot;&quot;</span>
    <span class="c1">## Atmospheric temperature (read via I2C)</span>
    <span class="n">atm_temperature</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Atmospheric temperature (read via I2C)&quot;&quot;&quot;</span>
    <span class="c1">## Atmospheric pressure</span>
    <span class="n">atm_pressure</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Atmospheric pressure&quot;&quot;&quot;</span>
    <span class="c1">## Atmospheric humidity</span>
    <span class="n">atm_humidity</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Atmospheric humidity&quot;&quot;&quot;</span>
    <span class="c1">## Acceleration of the antenna in X</span>
    <span class="n">acceleration_x</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acceleration of the antenna in X&quot;&quot;&quot;</span>
    <span class="c1">## Acceleration of the antenna in Y</span>
    <span class="n">acceleration_y</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acceleration of the antenna in Y&quot;&quot;&quot;</span>
    <span class="c1">## Acceleration of the antenna in Z</span>
    <span class="n">acceleration_z</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acceleration of the antenna in Z&quot;&quot;&quot;</span>
    <span class="c1">## Battery voltage</span>
    <span class="n">battery_level</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Battery voltage&quot;&quot;&quot;</span>
    <span class="c1">## Firmware version</span>
    <span class="n">firmware_version</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Firmware version&quot;&quot;&quot;</span>
    <span class="c1">## ADC sampling frequency in MHz</span>
    <span class="n">adc_sampling_frequency</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC sampling frequency in MHz&quot;&quot;&quot;</span>
    <span class="c1">## ADC sampling resolution in bits</span>
    <span class="n">adc_sampling_resolution</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC sampling resolution in bits&quot;&quot;&quot;</span>

    <span class="n">adc_input_channels_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC input channels&quot;&quot;&quot;</span>

    <span class="n">adc_enabled_channels_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;bool&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC enabled channels&quot;&quot;&quot;</span>

    <span class="n">adc_samples_count_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>

    <span class="n">trigger_pattern_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;bool&gt;&quot;</span><span class="p">))</span>
    <span class="n">trigger_pattern_ch0_ch1</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">trigger_pattern_notch0_ch1</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">trigger_pattern_redch0_ch1</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">trigger_pattern_ch2_ch3</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">trigger_pattern_calibration</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">trigger_pattern_10s</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">trigger_pattern_external_test_pulse</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>

    <span class="c1">## Trigger rate - the number of triggers recorded in the second preceding the event</span>
    <span class="n">trigger_rate</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trigger rate - the number of triggers recorded in the second preceding the event&quot;&quot;&quot;</span>
    <span class="c1">## Clock tick at which the event was triggered (used to calculate the trigger time)</span>
    <span class="n">clock_tick</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clock tick at which the event was triggered (used to calculate the trigger time)&quot;&quot;&quot;</span>
    <span class="c1">## Clock ticks per second</span>
    <span class="n">clock_ticks_per_second</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clock ticks per second&quot;&quot;&quot;</span>
    <span class="c1">## GPS offset - offset between the PPS and the real second (in GPS). ToDo: is it already included in the time calculations?</span>
    <span class="n">gps_offset</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS offset - offset between the PPS and the real second (in GPS). ToDo: is it already included in the time calculations?&quot;&quot;&quot;</span>
    <span class="c1">## GPS leap second</span>
    <span class="n">gps_leap_second</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS leap second&quot;&quot;&quot;</span>
    <span class="c1">## GPS status</span>
    <span class="n">gps_status</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS status&quot;&quot;&quot;</span>
    <span class="c1">## GPS alarms</span>
    <span class="n">gps_alarms</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS alarms&quot;&quot;&quot;</span>
    <span class="c1">## GPS warnings</span>
    <span class="n">gps_warnings</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS warnings&quot;&quot;&quot;</span>
    <span class="c1">## GPS time</span>
    <span class="n">gps_time</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS time&quot;&quot;&quot;</span>
    <span class="c1">## Longitude</span>
    <span class="n">gps_long</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned long long&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Longitude&quot;&quot;&quot;</span>
    <span class="c1">## Latitude</span>
    <span class="n">gps_lat</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned long long&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Latitude&quot;&quot;&quot;</span>
    <span class="c1">## Altitude</span>
    <span class="n">gps_alt</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned long long&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Altitude&quot;&quot;&quot;</span>
    <span class="c1">## GPS temperature</span>
    <span class="n">gps_temp</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS temperature&quot;&quot;&quot;</span>

    <span class="c1">## Digital control register</span>
    <span class="n">enable_auto_reset_timeout</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Digital control register&quot;&quot;&quot;</span>
    <span class="n">force_firmware_reset</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">enable_filter_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;bool&gt;&quot;</span><span class="p">))</span>
    <span class="n">enable_1PPS</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">enable_DAQ</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>

    <span class="c1">## Trigger enable mask register</span>
    <span class="n">enable_trigger_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;bool&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trigger enable mask register&quot;&quot;&quot;</span>
    <span class="n">enable_trigger_ch0_ch1</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">enable_trigger_notch0_ch1</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">enable_trigger_redch0_ch1</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">enable_trigger_ch2_ch3</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">enable_trigger_calibration</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">enable_trigger_10s</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">enable_trigger_external_test_pulse</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>

    <span class="c1">## Test pulse rate divider and channel readout enable</span>
    <span class="n">enable_readout_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;bool&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test pulse rate divider and channel readout enable&quot;&quot;&quot;</span>
    <span class="n">fire_single_test_pulse</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">))</span>
    <span class="n">test_pulse_rate_divider</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned char&quot;</span><span class="p">))</span>

    <span class="c1">## Common coincidence readout time window</span>
    <span class="n">common_coincidence_time</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common coincidence readout time window&quot;&quot;&quot;</span>

    <span class="c1">## Input selector for readout channel</span>
    <span class="n">selector_readout_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Input selector for readout channel&quot;&quot;&quot;</span>

    <span class="n">pre_coincidence_window_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
    <span class="n">post_coincidence_window_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>

    <span class="n">gain_correction_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
    <span class="n">integration_time_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
    <span class="n">offset_correction_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
    <span class="n">base_maximum_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
    <span class="n">base_minimum_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>

    <span class="n">signal_threshold_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
    <span class="n">noise_threshold_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
    <span class="n">tper_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
    <span class="n">tprev_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
    <span class="n">ncmax_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
    <span class="n">tcmax_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
    <span class="n">qmax_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
    <span class="n">ncmin_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>
    <span class="n">qmin_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned char&gt;&quot;</span><span class="p">))</span>

    <span class="c1">## ?? What is it? Some kind of the adc trace offset?</span>
    <span class="n">ioff</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;?? What is it? Some kind of the adc trace offset?&quot;&quot;&quot;</span>

    <span class="c1">## ADC traces for channels (0,1,2,3)</span>
    <span class="n">trace_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;vector&lt;short&gt;&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC traces for channels (0,1,2,3)&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="TRawVoltage">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TRawVoltage">[docs]</a>
<span class="nd">@dataclass</span>
<span class="c1">## The class for storing voltage traces and associated values for each event</span>
<span class="k">class</span> <span class="nc">TRawVoltage</span><span class="p">(</span><span class="n">MotherEventTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class for storing voltage traces and associated values at ADC input level for each event. Derived from TADC but in human readable format and physics units.&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rawvoltage&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;trawvoltage&quot;</span>
    <span class="c1">## Common for the whole event</span>
    <span class="c1">## Event size</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common for the whole event&quot;&quot;&quot;</span>
    <span class="n">event_size</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
    <span class="c1">## First detector unit that triggered in the event</span>
    <span class="n">first_du</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;First detector unit that triggered in the event&quot;&quot;&quot;</span>
    <span class="c1">## Unix time corresponding to the GPS seconds of the trigger</span>
    <span class="n">time_seconds</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time corresponding to the GPS seconds of the trigger&quot;&quot;&quot;</span>
    <span class="c1">## GPS nanoseconds corresponding to the trigger of the first triggered station</span>
    <span class="n">time_nanoseconds</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS nanoseconds corresponding to the trigger of the first triggered station&quot;&quot;&quot;</span>
    <span class="c1">## Number of detector units in the event - basically the antennas count</span>
    <span class="n">du_count</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of detector units in the event - basically the antennas count&quot;&quot;&quot;</span>

    <span class="c1">## Specific for each Detector Unit</span>
    <span class="c1">## Detector unit (antenna) ID</span>
    <span class="n">du_id</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) ID&quot;&quot;&quot;</span>
    <span class="c1">## Unix time of the trigger for this DU</span>
    <span class="n">du_seconds</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time of the trigger for this DU&quot;&quot;&quot;</span>
    <span class="c1">## Nanoseconds of the trigger for this DU</span>
    <span class="n">du_nanoseconds</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nanoseconds of the trigger for this DU&quot;&quot;&quot;</span>
    <span class="c1">## Same as event_type, but event_type could consist of different triggered DUs</span>
    <span class="n">trigger_flag</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Same as event_type, but event_type could consist of different triggered DUs&quot;&quot;&quot;</span>
    <span class="c1">## Atmospheric temperature (read via I2C)</span>
    <span class="n">atm_temperature</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Atmospheric temperature (read via I2C)&quot;&quot;&quot;</span>
    <span class="c1">## Atmospheric pressure</span>
    <span class="n">atm_pressure</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Atmospheric pressure&quot;&quot;&quot;</span>
    <span class="c1">## Atmospheric humidity</span>
    <span class="n">atm_humidity</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Atmospheric humidity&quot;&quot;&quot;</span>
    <span class="c1">## Acceleration of the antenna in (x,y,z) in m/s2</span>
    <span class="n">du_acceleration</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acceleration of the antenna in (x,y,z) in m/s2&quot;&quot;&quot;</span>
    <span class="c1">## Battery voltage</span>
    <span class="n">battery_level</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Battery voltage&quot;&quot;&quot;</span>
    <span class="c1">## ADC samples callected in channels (0,1,2,3)</span>
    <span class="n">adc_samples_count_channel</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;unsigned short&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ADC samples callected in channels (0,1,2,3)&quot;&quot;&quot;</span>
    <span class="c1">## Trigger pattern - which of the trigger sources (more than one may be present) fired to actually the trigger the digitizer - explained in the docs. ToDo: Decode this?</span>
    <span class="n">trigger_pattern</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trigger pattern - which of the trigger sources (more than one may be present) fired to actually the trigger the digitizer - explained in the docs. ToDo: Decode this?&quot;&quot;&quot;</span>
    <span class="c1">## Trigger rate - the number of triggers recorded in the second preceding the event</span>
    <span class="n">trigger_rate</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trigger rate - the number of triggers recorded in the second preceding the event&quot;&quot;&quot;</span>
    <span class="c1">## Clock tick at which the event was triggered (used to calculate the trigger time)</span>
    <span class="n">clock_tick</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clock tick at which the event was triggered (used to calculate the trigger time)&quot;&quot;&quot;</span>
    <span class="c1">## Clock ticks per second</span>
    <span class="n">clock_ticks_per_second</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clock ticks per second&quot;&quot;&quot;</span>
    <span class="c1">## GPS offset - offset between the PPS and the real second (in GPS). ToDo: is it already included in the time calculations?</span>
    <span class="n">gps_offset</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS offset - offset between the PPS and the real second (in GPS). ToDo: is it already included in the time calculations?&quot;&quot;&quot;</span>
    <span class="c1">## GPS leap second</span>
    <span class="n">gps_leap_second</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS leap second&quot;&quot;&quot;</span>
    <span class="c1">## GPS status</span>
    <span class="n">gps_status</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS status&quot;&quot;&quot;</span>
    <span class="c1">## GPS alarms</span>
    <span class="n">gps_alarms</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS alarms&quot;&quot;&quot;</span>
    <span class="c1">## GPS warnings</span>
    <span class="n">gps_warnings</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS warnings&quot;&quot;&quot;</span>
    <span class="c1">## GPS time</span>
    <span class="n">gps_time</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS time&quot;&quot;&quot;</span>
    <span class="c1">## Longitude</span>
    <span class="n">gps_long</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Longitude&quot;&quot;&quot;</span>
    <span class="c1">## Latitude</span>
    <span class="n">gps_lat</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Latitude&quot;&quot;&quot;</span>
    <span class="c1">## Altitude</span>
    <span class="n">gps_alt</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Altitude&quot;&quot;&quot;</span>
    <span class="c1">## GPS temperature</span>
    <span class="n">gps_temp</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS temperature&quot;&quot;&quot;</span>

    <span class="c1">## ?? What is it? Some kind of the adc trace offset?</span>
    <span class="n">ioff</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;?? What is it? Some kind of the adc trace offset?&quot;&quot;&quot;</span>

    <span class="c1">## Voltage traces for channels 1,2,3,4 in muV</span>
    <span class="n">trace_ch</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;vector&lt;float&gt;&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Voltage traces for channels 1,2,3,4 in muV&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="TVoltage">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TVoltage">[docs]</a>
<span class="nd">@dataclass</span>
<span class="c1">## The class for storing voltage traces and associated values for each event</span>
<span class="k">class</span> <span class="nc">TVoltage</span><span class="p">(</span><span class="n">MotherEventTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class for storing voltage traces and associated values at antenna feed point for each event&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;voltage&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tvoltage&quot;</span>

    <span class="c1">## Common for the whole event</span>
    <span class="c1">## First detector unit that triggered in the event</span>
    <span class="n">first_du</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;First detector unit that triggered in the event&quot;&quot;&quot;</span>
    <span class="c1">## Unix time corresponding to the GPS seconds of the trigger</span>
    <span class="n">time_seconds</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time corresponding to the GPS seconds of the trigger&quot;&quot;&quot;</span>
    <span class="c1">## GPS nanoseconds corresponding to the trigger of the first triggered station</span>
    <span class="n">time_nanoseconds</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS nanoseconds corresponding to the trigger of the first triggered station&quot;&quot;&quot;</span>
    <span class="c1">## Number of detector units in the event - basically the antennas count</span>
    <span class="n">du_count</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of detector units in the event - basically the antennas count&quot;&quot;&quot;</span>

    <span class="c1">## Specific for each Detector Unit</span>
    <span class="c1">## Detector unit (antenna) ID</span>
    <span class="n">du_id</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) ID&quot;&quot;&quot;</span>
    <span class="c1">## Unix time of the trigger for this DU</span>
    <span class="n">du_seconds</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time of the trigger for this DU&quot;&quot;&quot;</span>
    <span class="c1">## Nanoseconds of the trigger for this DU</span>
    <span class="n">du_nanoseconds</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nanoseconds of the trigger for this DU&quot;&quot;&quot;</span>
    <span class="c1">## Same as event_type, but event_type could consist of different triggered DUs</span>
    <span class="n">trigger_flag</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Same as event_type, but event_type could consist of different triggered DUs&quot;&quot;&quot;</span>
    <span class="c1">## Acceleration of the antenna in (x,y,z) in m/s2</span>
    <span class="n">du_acceleration</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acceleration of the antenna in (x,y,z) in m/s2&quot;&quot;&quot;</span>
    <span class="c1">## Trigger rate - the number of triggers recorded in the second preceding the event</span>
    <span class="n">trigger_rate</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trigger rate - the number of triggers recorded in the second preceding the event&quot;&quot;&quot;</span>

    <span class="c1">## Voltage traces for antenna arms (x,y,z)</span>
    <span class="n">trace</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;vector&lt;float&gt;&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Voltage traces for antenna arms (x,y,z)&quot;&quot;&quot;</span>
    <span class="c1"># _trace: StdVectorList = field(default_factory=lambda: StdVectorList(&quot;vector&lt;vector&lt;Float32_t&gt;&gt;&quot;))</span>

    <span class="c1">## Peak2peak amplitude (muV)</span>
    <span class="n">p2p</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Peak2peak amplitude (muV)&quot;&quot;&quot;</span>
    <span class="c1">## (Computed) peak time</span>
    <span class="n">time_max</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;(Computed) peak time&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="TEfield">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TEfield">[docs]</a>
<span class="nd">@dataclass</span>
<span class="c1">## The class for storing Efield traces and associated values for each event</span>
<span class="k">class</span> <span class="nc">TEfield</span><span class="p">(</span><span class="n">MotherEventTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class for storing Efield traces and associated values for each event&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;efield&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tefield&quot;</span>

    <span class="c1">## Common for the whole event</span>
    <span class="c1">## Unix time corresponding to the GPS seconds of the trigger</span>
    <span class="n">time_seconds</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time corresponding to the GPS seconds of the trigger&quot;&quot;&quot;</span>
    <span class="c1">## GPS nanoseconds corresponding to the trigger of the first triggered station</span>
    <span class="n">time_nanoseconds</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GPS nanoseconds corresponding to the trigger of the first triggered station&quot;&quot;&quot;</span>
    <span class="c1">## Trigger type 0x1000 10 s trigger and 0x8000 random trigger, else shower</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trigger type 0x1000 10 s trigger and 0x8000 random trigger, else shower&quot;&quot;&quot;</span>
    <span class="c1">## Number of detector units in the event - basically the antennas count</span>
    <span class="n">du_count</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of detector units in the event - basically the antennas count&quot;&quot;&quot;</span>

    <span class="c1">## Specific for each Detector Unit</span>
    <span class="c1">## Detector unit (antenna) ID</span>
    <span class="n">du_id</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned short&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detector unit (antenna) ID&quot;&quot;&quot;</span>
    <span class="c1">## Unix time of the trigger for this DU</span>
    <span class="n">du_seconds</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time of the trigger for this DU&quot;&quot;&quot;</span>
    <span class="c1">## Nanoseconds of the trigger for this DU</span>
    <span class="n">du_nanoseconds</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;unsigned int&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nanoseconds of the trigger for this DU&quot;&quot;&quot;</span>

    <span class="c1">## Efield traces for antenna arms (x,y,z)</span>
    <span class="n">trace</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;vector&lt;float&gt;&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Efield traces for antenna arms (x,y,z)&quot;&quot;&quot;</span>
    <span class="c1">## FFT magnitude for antenna arms (x,y,z)</span>
    <span class="n">fft_mag</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;vector&lt;float&gt;&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FFT magnitude for antenna arms (x,y,z)&quot;&quot;&quot;</span>
    <span class="c1">## FFT phase for antenna arms (x,y,z)</span>
    <span class="n">fft_phase</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;vector&lt;float&gt;&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FFT phase for antenna arms (x,y,z)&quot;&quot;&quot;</span>

    <span class="c1">## Peak-to-peak amplitudes for X, Y, Z (muV/m)</span>
    <span class="n">p2p</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Peak-to-peak amplitudes for X, Y, Z (muV/m)&quot;&quot;&quot;</span>
    <span class="c1">## Efield polarisation info</span>
    <span class="n">pol</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Efield polarisation info&quot;&quot;&quot;</span>
    <span class="c1">## (Computed) peak time</span>
    <span class="n">time_max</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;(Computed) peak time&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="TShower">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TShower">[docs]</a>
<span class="nd">@dataclass</span>
<span class="c1">## The class for storing reconstructed shower data common for each event</span>
<span class="k">class</span> <span class="nc">TShower</span><span class="p">(</span><span class="n">MotherEventTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class for storing shower data common for each event&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;shower&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tshower&quot;</span>

    <span class="c1">## Shower primary type</span>
    <span class="n">primary_type</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shower primary type&quot;&quot;&quot;</span>
    <span class="c1">## Energy from e+- (ie related to radio emission) (GeV)</span>
    <span class="n">energy_em</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy from e+- (ie related to radio emission) (GeV)&quot;&quot;&quot;</span>
    <span class="c1">## Total energy of the primary (including muons, neutrinos, ...) (GeV)</span>
    <span class="n">energy_primary</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Total energy of the primary (including muons, neutrinos, ...) (GeV)&quot;&quot;&quot;</span>
    <span class="c1">## Shower azimuth  (coordinates system = NWU + origin = core, &quot;pointing to&quot;)</span>
    <span class="n">azimuth</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shower azimuth  (coordinates system = NWU + origin = core, &quot;pointing to&quot;)&quot;&quot;&quot;</span>
    <span class="c1">## Shower zenith  (coordinates system = NWU + origin = core, , &quot;pointing to&quot;)</span>
    <span class="n">zenith</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shower zenith  (coordinates system = NWU + origin = core, , &quot;pointing to&quot;)&quot;&quot;&quot;</span>
    <span class="c1">## Direction vector (u_x, u_y, u_z)  of shower in GRAND detector ref</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">TTreeArrayDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeArrayDesc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Direction vector (u_x, u_y, u_z)  of shower in GRAND detector ref&quot;&quot;&quot;</span>
    <span class="c1">## Shower core position in GRAND detector ref (if it is an upgoing shower, there is no core position)</span>
    <span class="n">shower_core_pos</span><span class="p">:</span> <span class="n">TTreeArrayDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeArrayDesc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shower core position in GRAND detector ref (if it is an upgoing shower, there is no core position)&quot;&quot;&quot;</span>
    <span class="c1">## Atmospheric model name</span>
    <span class="n">atmos_model</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Atmospheric model name&quot;&quot;&quot;</span>
    <span class="c1">## Atmospheric model parameters</span>
    <span class="n">atmos_model_param</span><span class="p">:</span> <span class="n">TTreeArrayDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeArrayDesc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Atmospheric model parameters&quot;&quot;&quot;</span>
    <span class="c1">## Magnetic field parameters: Inclination, Declination, modulus</span>
    <span class="n">magnetic_field</span><span class="p">:</span> <span class="n">TTreeArrayDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeArrayDesc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Magnetic field parameters: Inclination, Declination, modulus&quot;&quot;&quot;</span>
    <span class="c1">## Ground Altitude at core position (m asl)</span>
    <span class="n">core_alt</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ground Altitude at core position (m asl)&quot;&quot;&quot;</span>
    <span class="c1">## Shower Xmax depth  (g/cm2 along the shower axis)</span>
    <span class="n">xmax_grams</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shower Xmax depth  (g/cm2 along the shower axis)&quot;&quot;&quot;</span>
    <span class="c1">## Shower Xmax position in GRAND detector ref</span>
    <span class="n">xmax_pos</span><span class="p">:</span> <span class="n">TTreeArrayDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeArrayDesc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shower Xmax position in GRAND detector ref&quot;&quot;&quot;</span>
    <span class="c1">## Shower Xmax position in shower coordinates</span>
    <span class="n">xmax_pos_shc</span><span class="p">:</span> <span class="n">TTreeArrayDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeArrayDesc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shower Xmax position in shower coordinates&quot;&quot;&quot;</span>
    <span class="c1">## Unix time when the shower was at the core position (seconds after epoch)</span>
    <span class="n">core_time_s</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time when the shower was at the core position (seconds after epoch)&quot;&quot;&quot;</span>
    <span class="c1">## Unix time when the shower was at the core position (seconds after epoch)</span>
    <span class="n">core_time_ns</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unix time when the shower was at the core position (seconds after epoch)&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="TRunEfieldSim">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TRunEfieldSim">[docs]</a>
<span class="nd">@dataclass</span>
<span class="c1">## The class for storing Efield sim-only data common for a whole run</span>
<span class="k">class</span> <span class="nc">TRunEfieldSim</span><span class="p">(</span><span class="n">MotherRunTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class for storing Efield sim-only data common for a whole run&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;runefieldsim&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;trunefieldsim&quot;</span>

    <span class="c1">## Name of the atmospheric index of refraction model</span>
    <span class="n">refractivity_model</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the atmospheric index of refraction model&quot;&quot;&quot;</span>
    <span class="n">refractivity_model_parameters</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">))</span>
    <span class="c1">## Starting time of antenna data collection time window (because it can be a shorter trace then voltage trace, and thus these parameters can be different)</span>
    <span class="n">t_pre</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Starting time of antenna data collection time window (because it can be a shorter trace then voltage trace, and thus these parameters can be different)&quot;&quot;&quot;</span>
    <span class="c1">## Finishing time of antenna data collection time window</span>
    <span class="n">t_post</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finishing time of antenna data collection time window&quot;&quot;&quot;</span>

    <span class="c1">## Simulator name (aires/corsika, etc.)</span>
    <span class="n">sim_name</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulator name (aires/corsika, etc.)&quot;&quot;&quot;</span>
    <span class="c1">## Simulator version string</span>
    <span class="n">sim_version</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulator version string&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_branches</span><span class="p">()</span></div>



<div class="viewcode-block" id="TRunShowerSim">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TRunShowerSim">[docs]</a>
<span class="nd">@dataclass</span>
<span class="c1">## The class for storing shower sim-only data common for a whole run</span>
<span class="k">class</span> <span class="nc">TRunShowerSim</span><span class="p">(</span><span class="n">MotherRunTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run-level info associated with simulated showers&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;runshowersim&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;trunshowersim&quot;</span>

    <span class="c1">## relative thinning energy</span>
    <span class="n">rel_thin</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;relative thinning energy&quot;&quot;&quot;</span>
    <span class="c1"># maximum_weight (weight factor)</span>
    <span class="n">maximum_weight</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;the maximum weight, computed in zhaires as PrimaryEnergy*RelativeThinning*WeightFactor/14.0 (see aires manual section 3.3.6 and 2.3.2) to make it mean the same as Corsika Wmax&quot;&quot;&quot;</span>

    <span class="n">hadronic_thinning</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;the ratio of energy at wich thining starts in hadrons and electromagnetic particles&quot;&quot;&quot;</span>
    <span class="n">hadronic_thinning_weight</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;the ratio of electromagnetic to hadronic maximum weights&quot;&quot;&quot;</span>

    <span class="c1">## low energy cut for electrons (GeV)</span>
    <span class="n">lowe_cut_e</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;low energy cut for electrons (GeV)&quot;&quot;&quot;</span>
    <span class="c1">## low energy cut for gammas (GeV)</span>
    <span class="n">lowe_cut_gamma</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;low energy cut for gammas (GeV)&quot;&quot;&quot;</span>
    <span class="c1">## low energy cut for muons (GeV)</span>
    <span class="n">lowe_cut_mu</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;low energy cut for muons (GeV)&quot;&quot;&quot;</span>
    <span class="c1">## low energy cut for mesons (GeV)</span>
    <span class="n">lowe_cut_meson</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;low energy cut for mesons (GeV)&quot;&quot;&quot;</span>
    <span class="c1">## low energy cut for nuceleons (GeV)</span>
    <span class="n">lowe_cut_nucleon</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;low energy cut for nuceleons (GeV)&quot;&quot;&quot;</span>
    <span class="c1">## Site for wich the smulation was done</span>
    <span class="n">site</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Site for wich the smulation was done&quot;&quot;&quot;</span>
    <span class="c1">## Simulator name (aires/corsika, etc.)</span>
    <span class="n">sim_name</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulator name (aires/corsika, etc.)&quot;&quot;&quot;</span>
    <span class="c1">## Simulator version string</span>
    <span class="n">sim_version</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulator version string&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_branches</span><span class="p">()</span></div>



<div class="viewcode-block" id="TShowerSim">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TShowerSim">[docs]</a>
<span class="nd">@dataclass</span>
<span class="c1">## The class for storing a shower sim-only data for each event</span>
<span class="k">class</span> <span class="nc">TShowerSim</span><span class="p">(</span><span class="n">MotherEventTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Event-level info associated with simulated showers&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;showersim&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tshowersim&quot;</span>

    <span class="c1">## File name in the simulator</span>
    <span class="n">input_name</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;File name in the simulator&quot;&quot;&quot;</span>
    <span class="c1">## The date for which we simulate the event (epoch)</span>
    <span class="n">event_date</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The date for which we simulate the event (epoch)&quot;&quot;&quot;</span>
    <span class="c1">## Random seed</span>
    <span class="n">rnd_seed</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Random seed&quot;&quot;&quot;</span>
    <span class="c1">## Primary energy (GeV)</span>
    <span class="c1"># primary_energy: StdVectorListDesc = field(default=StdVectorListDesc(&quot;float&quot;))</span>
    <span class="c1">## Primary particle type</span>
    <span class="c1"># primary_type: StdVectorListDesc = field(default=StdVectorListDesc(&quot;string&quot;))</span>
    <span class="c1">## Primary injection point in Shower Coordinates</span>
    <span class="n">primary_inj_point_shc</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Primary injection point in Shower Coordinates&quot;&quot;&quot;</span>
    <span class="c1">## Primary injection altitude in Shower Coordinates</span>
    <span class="n">primary_inj_alt_shc</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Primary injection altitude in Shower Coordinates&quot;&quot;&quot;</span>
    <span class="c1">## Primary injection direction in Shower Coordinates</span>
    <span class="n">primary_inj_dir_shc</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Primary injection direction in Shower Coordinates&quot;&quot;&quot;</span>

    <span class="c1">## Table of air density [g/cm3] and vertical depth [g/cm2] versus altitude [m]</span>
    <span class="n">atmos_altitude</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Table of air density [g/cm3] and vertical depth [g/cm2] versus altitude [m]&quot;&quot;&quot;</span>
    <span class="n">atmos_density</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
    <span class="n">atmos_depth</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>

    <span class="c1">## High energy hadronic model (and version) used</span>
    <span class="n">hadronic_model</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;High energy hadronic model (and version) used&quot;&quot;&quot;</span>
    <span class="c1">## Energy model (and version) used</span>
    <span class="n">low_energy_model</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy model (and version) used&quot;&quot;&quot;</span>
    <span class="c1">## Time it took for the sim</span>
    <span class="n">cpu_time</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Time it took for the sim&quot;&quot;&quot;</span>

    <span class="c1">## Slant depth of the observing levels for longitudinal development tables</span>
    <span class="n">long_depth</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Slant depth of the observing levels for longitudinal development tables&quot;&quot;&quot;</span>
    <span class="n">long_pd_depth</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
    <span class="c1">## Number of electrons</span>
    <span class="n">long_pd_eminus</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of electrons&quot;&quot;&quot;</span>
    <span class="c1">## Number of positrons</span>
    <span class="n">long_pd_eplus</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of positrons&quot;&quot;&quot;</span>
    <span class="c1">## Number of muons-</span>
    <span class="n">long_pd_muminus</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of muons-&quot;&quot;&quot;</span>
    <span class="c1">## Number of muons+</span>
    <span class="n">long_pd_muplus</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of muons+&quot;&quot;&quot;</span>
    <span class="c1">## Number of gammas</span>
    <span class="n">long_pd_gamma</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of gammas&quot;&quot;&quot;</span>
    <span class="c1">## Number of pions, kaons, etc.</span>
    <span class="n">long_pd_hadron</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of pions, kaons, etc.&quot;&quot;&quot;</span>
    <span class="c1">## Energy in low energy gammas</span>
    <span class="n">long_gamma_elow</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy in low energy gammas&quot;&quot;&quot;</span>
    <span class="c1">## Energy in low energy e+/e-</span>
    <span class="n">long_e_elow</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy in low energy e+/e-&quot;&quot;&quot;</span>
    <span class="c1">## Energy deposited by e+/e-</span>
    <span class="n">long_e_edep</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy deposited by e+/e-&quot;&quot;&quot;</span>
    <span class="c1">## Energy in low energy mu+/mu-</span>
    <span class="n">long_mu_elow</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy in low energy mu+/mu-&quot;&quot;&quot;</span>
    <span class="c1">## Energy deposited by mu+/mu-</span>
    <span class="n">long_mu_edep</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy deposited by mu+/mu-&quot;&quot;&quot;</span>
    <span class="c1">## Energy in low energy hadrons</span>
    <span class="n">long_hadron_elow</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy in low energy hadrons&quot;&quot;&quot;</span>
    <span class="c1">## Energy deposited by hadrons</span>
    <span class="n">long_hadron_edep</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy deposited by hadrons&quot;&quot;&quot;</span>
    <span class="c1">## Energy in created neutrinos</span>
    <span class="n">long_neutrino</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Energy in created neutrinos&quot;&quot;&quot;</span>
    <span class="c1">## Core positions tested for that shower to generate the event (effective area study)</span>
    <span class="n">tested_core_positions</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core positions tested for that shower to generate the event (effective area study)&quot;&quot;&quot;</span>

    <span class="n">event_weight</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;statistical weight given to the event&quot;&quot;&quot;</span>
    <span class="n">tested_cores</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;tested core positions&quot;&quot;&quot;</span></div>



<span class="c1">## General info on the noise generation</span>
<div class="viewcode-block" id="TRunNoise">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.TRunNoise">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TRunNoise</span><span class="p">(</span><span class="n">MotherRunTree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;General info on the noise generation&quot;&quot;&quot;</span>

    <span class="n">_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;runnoise&quot;</span>

    <span class="n">_tree_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;trunnoise&quot;</span>

    <span class="c1">## Info to retrieve the map of galactic noise</span>
    <span class="n">gal_noise_map</span><span class="p">:</span> <span class="n">StdStringDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdStringDesc</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Info to retrieve the map of galactic noise&quot;&quot;&quot;</span>
    <span class="c1">## LST time when we generate the noise</span>
    <span class="n">gal_noise_LST</span><span class="p">:</span> <span class="n">TTreeScalarDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TTreeScalarDesc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LST time when we generate the noise&quot;&quot;&quot;</span>
    <span class="c1">## Noise std dev for each arm of each antenna</span>
    <span class="n">gal_noise_sigma</span><span class="p">:</span> <span class="n">StdVectorListDesc</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">StdVectorListDesc</span><span class="p">(</span><span class="s2">&quot;vector&lt;float&gt;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Noise std dev for each arm of each antenna&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_branches</span><span class="p">()</span></div>



<span class="c1">## Exception raised when an already existing event/run is added to a tree</span>
<div class="viewcode-block" id="NotUniqueEvent">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.NotUniqueEvent">[docs]</a>
<span class="k">class</span> <span class="nc">NotUniqueEvent</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception raised when an already existing event/run is added to a tree&quot;&quot;&quot;</span>

    <span class="k">pass</span></div>



<span class="c1">## General setter for vectors of vectors</span>
<div class="viewcode-block" id="set_vector_of_vectors">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.set_vector_of_vectors">[docs]</a>
<span class="k">def</span> <span class="nf">set_vector_of_vectors</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">vec_type</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">):</span>
    <span class="c1"># A list was given</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StdVectorList</span><span class="p">):</span>
        <span class="c1"># Clear the vector before setting</span>
        <span class="n">variable</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">variable</span> <span class="o">+=</span> <span class="n">value</span>
    <span class="c1"># A vector of vectors was given</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="n">vec_type</span><span class="p">)):</span>
        <span class="n">variable</span><span class="o">.</span><span class="n">_vector</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;vector&quot;</span> <span class="ow">in</span> <span class="n">vec_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Incorrect type for </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">. Either a list of lists, a list of arrays or a ROOT.vector of vectors required.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Incorrect type for </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">. Either a list, an array or a ROOT.vector required.&quot;</span>
            <span class="p">)</span></div>



<span class="c1">## Class holding the information about GRAND data in a directory</span>
<div class="viewcode-block" id="DataDirectory">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataDirectory">[docs]</a>
<span class="k">class</span> <span class="nc">DataDirectory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class holding the information about GRAND data in a directory&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param dir_name: the name of the directory to be scanned</span>
<span class="sd">        @param recursive: if to scan the directory recursively</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Make the path absolute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>

        <span class="c1"># Get the file list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_of_files</span><span class="p">(</span><span class="n">recursive</span><span class="p">)</span>

        <span class="c1"># Get the file handle list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_handle_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_of_files_handles</span><span class="p">()</span>

        <span class="c1"># Create chains and set them as attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_chains</span><span class="p">()</span>

<div class="viewcode-block" id="DataDirectory.get_list_of_files">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataDirectory.get_list_of_files">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list_of_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets list of files in the directory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span><span class="p">,</span> <span class="s2">&quot;*.root&quot;</span><span class="p">),</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">))</span></div>


<div class="viewcode-block" id="DataDirectory.get_list_of_files_handles">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataDirectory.get_list_of_files_handles">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list_of_files_handles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Go through the list of files in the directory and open all of them&quot;&quot;&quot;</span>
        <span class="n">file_handle_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
            <span class="n">file_handle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DataFile</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">file_handle_list</span></div>


<div class="viewcode-block" id="DataDirectory.create_chains">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataDirectory.create_chains">[docs]</a>
    <span class="k">def</span> <span class="nf">create_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">chains_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tree_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># Loop through the list of file handles</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_handle_list</span><span class="p">):</span>
            <span class="c1"># Collect the tree types</span>
            <span class="n">tree_types</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="o">.</span><span class="n">tree_types</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="c1"># Select the highest analysis level trees for each class and store these trees as main attributes</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">tree_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;run&quot;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;trun&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">dict_of_trees</span><span class="p">[</span><span class="s2">&quot;trun&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">max_analysis_level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">tree_types</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tree_types</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">key1</span><span class="p">]</span>
                        <span class="n">chain_name</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s2">&quot;analysis_level&quot;</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_analysis_level</span> <span class="ow">or</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">max_analysis_level</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">]</span>
                                <span class="n">max_anal_chain_name</span> <span class="o">=</span> <span class="n">chain_name</span>

                                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">]),</span> <span class="n">f</span><span class="o">.</span><span class="n">dict_of_trees</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]])</span>

                        <span class="k">if</span> <span class="n">chain_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chains_dict</span><span class="p">:</span>
                            <span class="n">chains_dict</span><span class="p">[</span><span class="n">chain_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TChain</span><span class="p">(</span><span class="n">chain_name</span><span class="p">)</span>
                        <span class="n">chains_dict</span><span class="p">[</span><span class="n">chain_name</span><span class="p">]</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                        <span class="c1"># In case there is no analysis level info in the tree (old trees), just take the last one</span>
                        <span class="k">if</span> <span class="n">max_analysis_level</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">max_anal_chain_name</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="n">chains_dict</span><span class="p">[</span><span class="n">max_anal_chain_name</span><span class="p">])</span></div>


<div class="viewcode-block" id="DataDirectory.print">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataDirectory.print">[docs]</a>
    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints all the information about all the data&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="DataDirectory.get_list_of_chains">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataDirectory.get_list_of_chains">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list_of_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets list of TTree chains of specific type from the directory&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="DataDirectory.print_list_of_chains">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataDirectory.print_list_of_chains">[docs]</a>
    <span class="k">def</span> <span class="nf">print_list_of_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints list of TTree chains of specific type from the directory&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="DataFile">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataFile">[docs]</a>
<span class="k">class</span> <span class="nc">DataFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class holding the information about GRAND TTrees in the specified file&quot;&quot;&quot;</span>

    <span class="c1">## Holds all the trees in the file, by tree name</span>
    <span class="n">dict_of_trees</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Holds all the trees in the file, by tree name&quot;&quot;&quot;</span>
    <span class="c1">## Holds the list of trees in the file, but just with maximal level</span>
    <span class="n">list_of_trees</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Holds the list of trees in the file, but just with maximal level&quot;&quot;&quot;</span>
    <span class="c1">## Holds dict of tree types, each containing a dict of tree names with tree meta-data as values</span>
    <span class="n">tree_types</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Holds dict of tree types, each containing a dict of tree names with tree meta-data as values&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;filename can be either a string or a ROOT.TFile&quot;&quot;&quot;</span>
        <span class="c1"># If a string given, open the file</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="si">}</span><span class="s2"> as a filename&quot;</span><span class="p">)</span>

        <span class="c1"># Loop through the keys</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">GetListOfKeys</span><span class="p">():</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">GetName</span><span class="p">())</span>
            <span class="c1"># Process only TTrees</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TTree</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Get the basic information about the tree</span>
            <span class="n">tree_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tree_info</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="c1"># Add the tree to a dict for this tree class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">[</span><span class="n">tree_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]][</span><span class="n">tree_info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tree_info</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dict_of_trees</span><span class="p">[</span><span class="n">tree_info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">t</span>

        <span class="c1"># Select the highest analysis level trees for each class and store these trees as main attributes</span>
        <span class="c1"># Loop through tree types</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;run&quot;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;trun&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_of_trees</span><span class="p">[</span><span class="s2">&quot;trun&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_analysis_level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="c1"># Loop through trees in the current tree type</span>
                <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">key1</span><span class="p">]</span>
                    <span class="n">tree_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">thismodule</span><span class="p">,</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                    <span class="n">tree_instance</span> <span class="o">=</span> <span class="n">tree_class</span><span class="p">(</span><span class="n">_tree_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_of_trees</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]])</span>
                    <span class="c1"># If there is analysis level info in the tree, attribute each level and max level</span>
                    <span class="k">if</span> <span class="s2">&quot;analysis_level&quot;</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_analysis_level</span> <span class="ow">or</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">max_analysis_level</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">]</span>
                            <span class="n">max_anal_tree_name</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                            <span class="n">max_anal_tree_type</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree_class</span><span class="o">.</span><span class="n">get_default_tree_name</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s2">&quot;analysis_level&quot;</span><span class="p">]),</span> <span class="n">tree_instance</span><span class="p">)</span>
                    <span class="c1"># In case there is no analysis level info in the tree (old trees), just take the last one</span>
                    <span class="k">elif</span> <span class="n">max_analysis_level</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">max_anal_tree_name</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                        <span class="n">max_anal_tree_type</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

                    <span class="n">traces_lenghts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_traces_lengths</span><span class="p">(</span><span class="n">tree_instance</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">traces_lenghts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">el</span><span class="p">[</span><span class="s2">&quot;traces_lengths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">traces_lenghts</span>

                    <span class="n">dus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_list_of_all_used_dus</span><span class="p">(</span><span class="n">tree_instance</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">el</span><span class="p">[</span><span class="s2">&quot;dus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dus</span>

                    <span class="n">el</span><span class="p">[</span><span class="s2">&quot;mem_size&quot;</span><span class="p">],</span> <span class="n">el</span><span class="p">[</span><span class="s2">&quot;disk_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree_instance</span><span class="o">.</span><span class="n">get_tree_size</span><span class="p">()</span>

                <span class="n">tree_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">thismodule</span><span class="p">,</span> <span class="n">max_anal_tree_type</span><span class="p">)</span>
                <span class="n">tree_instance</span> <span class="o">=</span> <span class="n">tree_class</span><span class="p">(</span><span class="n">_tree_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_of_trees</span><span class="p">[</span><span class="n">max_anal_tree_name</span><span class="p">])</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree_class</span><span class="o">.</span><span class="n">get_default_tree_name</span><span class="p">(),</span> <span class="n">tree_instance</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list_of_trees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_of_trees</span><span class="p">[</span><span class="n">max_anal_tree_name</span><span class="p">])</span>

<div class="viewcode-block" id="DataFile.print">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataFile.print">[docs]</a>
    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints the information about the TTrees in the file&quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree classes found in the file: </span><span class="si">{</span><span class="nb">str</span><span class="p">([</span><span class="n">el</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">el</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trees of type </span><span class="si">{</span><span class="n">key</span><span class="si">:</span><span class="s2">&lt;40</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">([</span><span class="n">el</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">el</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="si">:</span><span class="s2">&lt;40</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># print(f&quot;{key1}: {self.tree_types[key][key1]}&quot;)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">key1</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">key2</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataFile.get_tree_info">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataFile.get_tree_info">[docs]</a>
    <span class="k">def</span> <span class="nf">get_tree_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the information about the tree&quot;&quot;&quot;</span>

        <span class="c1"># If tree is a string, turn it into a TTree</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
        <span class="c1"># If tree is a GRAND tree class</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">DataTree</span><span class="p">):</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">_tree</span>

        <span class="n">tree_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;evt_cnt&quot;</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">GetEntries</span><span class="p">(),</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">GetName</span><span class="p">()}</span>

        <span class="n">meta_dict</span> <span class="o">=</span> <span class="n">DataTree</span><span class="o">.</span><span class="n">get_metadata_as_dict</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="c1"># Deduce the tree type if not in the metadata</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">meta_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">tree_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guess_tree_type</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="n">tree_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">meta_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tree_info</span></div>


    <span class="k">def</span> <span class="nf">_get_traces_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds traces info to event trees&quot;&quot;&quot;</span>
        <span class="c1"># If tree is not of Event class (contains traces), do nothing</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">MotherEventTree</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;sim&quot;</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">tree_name</span> <span class="ow">or</span> <span class="s2">&quot;zhaires&quot;</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">tree_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">traces_lengths</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_traces_lengths</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">traces_lengths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Check if traces have constant length</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">traces_lengths</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traces lengths vary through events or axes for </span><span class="si">{</span><span class="n">tree</span><span class="o">.</span><span class="n">tree_name</span><span class="si">}</span><span class="s2">! </span><span class="si">{</span><span class="n">traces_lengths</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">traces_lengths</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">traces_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_list_of_all_used_dus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of all data units used in the tree&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">MotherEventTree</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_list_of_all_used_dus</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="DataFile.print_tree_info">
<a class="viewcode-back" href="../../../grand.dataio.html#grand.dataio.root_trees.DataFile.print_tree_info">[docs]</a>
    <span class="k">def</span> <span class="nf">print_tree_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints the information about the tree&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


    <span class="k">def</span> <span class="nf">_guess_tree_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Guesses the tree type from its name. Needed for old trees with missing metadata&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>

        <span class="c1"># Sim trees</span>
        <span class="k">if</span> <span class="s2">&quot;sim&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="c1"># if &quot;runvoltage&quot; in name:</span>
            <span class="c1">#     return &quot;VoltageRunSimdataTree&quot;</span>
            <span class="c1"># elif &quot;eventvoltage&quot; in name:</span>
            <span class="c1">#     return &quot;VoltageEventSimdataTree&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;runefield&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;TRunEfieldSim&quot;</span>
            <span class="c1"># elif &quot;eventefield&quot; in name:</span>
            <span class="c1">#     return &quot;EfieldEventSimdataTree&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;runshower&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;TRunShowerSim&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;shower&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;TShowerSim&quot;</span>
        <span class="c1"># # Zhaires tree</span>
        <span class="c1"># elif &quot;eventshowerzhaires&quot; in name:</span>
        <span class="c1">#     return &quot;ShowerEventZHAireSTree&quot;</span>
        <span class="c1"># Other trees</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;run&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;TRun&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;adc&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;TADC&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;voltage&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;TRawVoltage&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;efield&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;TEfield&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;shower&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;TShower&quot;</span>

    <span class="k">def</span> <span class="nf">_load_trees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Loop through the keys</span>
        <span class="c1"># Process only TTrees</span>
        <span class="c1"># Get the basic information about the tree</span>
        <span class="c1"># Add the tree to a dict for this tree class</span>
        <span class="c1"># Select the highest analysis level trees for each class and store these trees as main attributes</span>
        <span class="k">pass</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, GRAND Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>