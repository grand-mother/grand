<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>src_outlib.xdu_rf_ref &mdash; grandlib 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            grandlib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">grandlib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">src_outlib.xdu_rf_ref</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for src_outlib.xdu_rf_ref</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># =======================================================</span>
<span class="c1">#    / \</span>
<span class="c1">#   / | \        ** READ ONLY ****** NOT MODIFY **</span>
<span class="c1">#  /  *  \</span>
<span class="c1"># ---------</span>
<span class="c1"># =======================================================</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># From : https://github.com/JuliusErv1ng/XDU-RF-chain-simulation/blob/main/XDU%20RF%20chain%20code.py</span>
<span class="c1"># @authors PengFei and Xidian group</span>
<span class="c1"># This Python file uses the following encoding: utf-8</span>


<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">scipy.fftpack</span> <span class="kn">import</span> <span class="n">fft</span>
<span class="kn">from</span> <span class="nn">scipy.fftpack</span> <span class="kn">import</span> <span class="n">ifft</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">log10</span><span class="p">,</span> <span class="nb">abs</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># ==============================time domain shower Edata get===============================</span>
<div class="viewcode-block" id="time_data_get">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.time_data_get">[docs]</a>
<span class="k">def</span> <span class="nf">time_data_get</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">):</span>
    <span class="c1"># This Python file uses the following encoding: utf-8</span>

    <span class="c1"># This program, as a subroutine, completes the reading of the shower time domain signal, ===========================================================</span>
    <span class="c1"># intercepts part of the signal or extends the length of the signal, and generates parameters according to the time domain requirements == == == == =</span>
    <span class="c1">#  ----------------------input - ---------------------------------- %</span>
    <span class="c1"># filename:path</span>
    <span class="c1"># Ts:time interval</span>
    <span class="c1"># % show_flag:flag of showing picture</span>

    <span class="c1"># % ----------------------output - ---------------------------------- %</span>
    <span class="c1"># % t:time sequence, unit:ns</span>
    <span class="c1"># % E_shower_cut:Corresponding to the triple polarization component of the time series，unit:uv</span>
    <span class="c1"># % fs % sampling frequency, unit:MHZ</span>
    <span class="c1"># % f0 % base frequency, Frequency resolution，unit:MHZ</span>
    <span class="c1"># % f  % frequency sequence，unit:MHz</span>
    <span class="c1"># % f1 % Unilateral spectrum frequency sequence，unit:MHz</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1"># = == == == == == == == == == =Time-frequency parameter generation == == == == == == == == == == == == == == == == == == == == ==</span>
    <span class="c1"># = == == =In order to make the frequency resolution 1MHz, the number of sampling points = sampling frequency == == == =</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Ts</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># sampling frequency, MHZ</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">fs</span> <span class="o">/</span> <span class="n">N</span>  <span class="c1"># base frequency, Frequency resolution</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">f0</span>  <span class="c1"># frequency sequence</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Take only half, pay attention to odd and even numbers, odd numbers: the floor(N / 2 + 1) is conjugated to floor(N / 2 + 1) + 1;</span>
    <span class="c1"># Even number: floor(N / 2 + 1)-1 and floor(N / 2 + 1) + 1 are conjugated;</span>

    <span class="c1"># = == == == Change the original signal length to be the same as N======================</span>
    <span class="n">t_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">))</span>
    <span class="n">ex_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">))</span>
    <span class="n">ey_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">))</span>
    <span class="n">ez_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">))</span>

    <span class="n">lt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="n">lt</span><span class="p">:</span>
        <span class="c1"># ============================In order to avoid not getting the peak value, judge whether the peak value is within N == == == == == == == =</span>
        <span class="n">posx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="n">posy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span>
        <span class="n">posz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ez</span><span class="p">)</span>
        <span class="n">hang</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">posx</span><span class="p">,</span> <span class="n">posy</span><span class="p">,</span> <span class="n">posz</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hang</span> <span class="o">&gt;=</span> <span class="n">N</span><span class="p">:</span>
            <span class="n">t_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">hang</span> <span class="o">-</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">):</span> <span class="n">hang</span><span class="p">]</span>
            <span class="n">t_cut</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">hang</span><span class="p">:</span> <span class="n">hang</span> <span class="o">+</span> <span class="mi">500</span><span class="p">]</span>

            <span class="n">ex_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="n">hang</span> <span class="o">-</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">):</span> <span class="n">hang</span><span class="p">]</span>
            <span class="n">ex_cut</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="n">hang</span><span class="p">:</span> <span class="n">hang</span> <span class="o">+</span> <span class="mi">500</span><span class="p">]</span>

            <span class="n">ey_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="n">ey</span><span class="p">[</span><span class="n">hang</span> <span class="o">-</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">):</span> <span class="n">hang</span><span class="p">]</span>
            <span class="n">ey_cut</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">ey</span><span class="p">[</span><span class="n">hang</span><span class="p">:</span> <span class="n">hang</span> <span class="o">+</span> <span class="mi">500</span><span class="p">]</span>

            <span class="n">ez_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="n">ez</span><span class="p">[</span><span class="n">hang</span> <span class="o">-</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">):</span> <span class="n">hang</span><span class="p">]</span>
            <span class="n">ez_cut</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="mi">500</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">ez</span><span class="p">[</span><span class="n">hang</span><span class="p">:</span> <span class="n">hang</span> <span class="o">+</span> <span class="mi">500</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">]</span>
            <span class="n">ex_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span>
            <span class="n">ey_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span>
            <span class="n">ez_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">N</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">lt</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span>
        <span class="n">ex_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">lt</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span>
        <span class="n">ey_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">lt</span><span class="p">]</span> <span class="o">=</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span>
        <span class="n">ez_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">lt</span><span class="p">]</span> <span class="o">=</span> <span class="n">ez</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ts</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ts</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">lt</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># There is always a problem with the accuracy of decimal addition and subtraction. After +2, no matter if the decimal becomes .9999 or .000001, it is guaranteed to get the first n-lt number.</span>
        <span class="n">add</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ts</span><span class="p">)</span>
        <span class="n">t_cut</span><span class="p">[</span><span class="n">lt</span><span class="p">:]</span> <span class="o">=</span> <span class="n">add</span><span class="p">[:(</span><span class="n">N</span> <span class="o">-</span> <span class="n">lt</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">show_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_cut</span><span class="p">,</span> <span class="n">ex_cut</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time(ns)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Ex(uv/m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_cut</span><span class="p">,</span> <span class="n">ey_cut</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time(ns)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Ey(uv/m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_cut</span><span class="p">,</span> <span class="n">ez_cut</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time(ns)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Ez(uv/m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;E Fields of Shower in Time Domain&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t_cut</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ex_cut</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ey_cut</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ez_cut</span><span class="p">),</span> <span class="n">fs</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">N</span></div>



<span class="c1"># ================================================FFT get=============================================</span>
<div class="viewcode-block" id="fftget">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.fftget">[docs]</a>
<span class="k">def</span> <span class="nf">fftget</span><span class="p">(</span><span class="n">data_ori</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">):</span>
    <span class="c1"># This Python file uses the following encoding: utf-8</span>

    <span class="c1"># = == == == == This program is used as a subroutine to complete the FFT of data and generate parameters according to requirements == == == == =</span>
    <span class="c1">#  ----------------------input- ---------------------------------- %</span>
    <span class="c1"># % data_ori:time domain data, matrix form</span>
    <span class="c1"># % show_flag:flag of showing picture</span>
    <span class="c1"># % N:number of FFT points</span>
    <span class="c1"># % f1:Unilateral frequency</span>
    <span class="c1"># % ----------------------output - ---------------------------------- %</span>
    <span class="c1"># % data_fft:Frequency domain complex data</span>
    <span class="c1"># % data_fft_m_single:Frequency domain amplitude unilateral spectrum</span>
    <span class="c1"># % data_fft:Frequency domain phase</span>

    <span class="n">lienum</span> <span class="o">=</span> <span class="n">data_ori</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">data_fft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">lienum</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">data_fft_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">lienum</span><span class="p">))</span>
    <span class="c1"># data_fft_m_single = np.zeros((int(N/2), lienum))</span>
    <span class="c1"># data_fft_p = np.zeros((int(N), lienum))</span>
    <span class="c1"># data_fft_p_single = np.zeros((int(N/2), lienum))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lienum</span><span class="p">):</span>
        <span class="n">data_fft</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">data_ori</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>

        <span class="n">data_fft_m</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data_fft</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">N</span>  <span class="c1"># Amplitude</span>
        <span class="n">data_fft_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_fft_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">data_fft_m_single</span> <span class="o">=</span> <span class="n">data_fft_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">f1</span><span class="p">)]</span>  <span class="c1"># unilateral</span>

        <span class="n">data_fft_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">data_fft</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># phase</span>
        <span class="n">data_fft_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">data_fft_p</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">180</span><span class="p">)</span>
        <span class="c1"># data_fft_p_deg = np.rad2deg(data_fft_p)</span>
        <span class="n">data_fft_p_single</span> <span class="o">=</span> <span class="n">data_fft_p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">f1</span><span class="p">)]</span>

    <span class="n">string</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">show_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lienum</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">data_fft_m_single</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;E&quot;</span> <span class="o">+</span> <span class="n">string</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(uv/m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Electric Field Spectrum&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>  <span class="c1"># The smaller the value, the farther away</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lienum</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">data_fft_p_single</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;E&quot;</span> <span class="o">+</span> <span class="n">string</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(deg)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Electric Field Phase&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_fft</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_fft_m_single</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_fft_p_single</span><span class="p">)</span></div>



<span class="c1"># =====================================IFFT get=================================================</span>
<div class="viewcode-block" id="ifftget">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.ifftget">[docs]</a>
<span class="k">def</span> <span class="nf">ifftget</span><span class="p">(</span><span class="n">data_ori</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">true</span><span class="p">):</span>
    <span class="c1"># This Python file uses the following encoding: utf-8</span>


    <span class="c1"># %= == == == == This program is used as a subroutine to complete the Fourier change of data and generate parameters according to requirements == == == == =</span>
    <span class="c1"># % ----------------------input - ---------------------------------- %</span>
    <span class="c1"># % data_ori:Frequency domain data, complex numbers</span>
    <span class="c1"># % true  1 indicates that the complex number is synthesized, that is, the amplitude is the real amplitude. 2 indicates that the complex number is obtained after Fourier transform;</span>
    <span class="c1"># % N:number of FFT points</span>
    <span class="c1"># % t:time sequence</span>
    <span class="c1"># ns</span>
    <span class="c1"># % ----------------------output - ---------------------------------- %</span>
    <span class="c1"># % data_ifft :time domain data</span>

    <span class="n">lienum</span> <span class="o">=</span> <span class="n">data_ori</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># %= == == == == == == == == == == == == == == First draw the spectrum phase == == == == == ==</span>
    <span class="n">data_ori_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">lienum</span><span class="p">))</span>
    <span class="n">data_ori_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">lienum</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">true</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lienum</span><span class="p">):</span>
            <span class="n">data_ori_m</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data_ori</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>  <span class="c1"># Amplitude</span>
            <span class="n">data_ori_m_single</span> <span class="o">=</span> <span class="n">data_ori_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">f1</span><span class="p">)]</span>  <span class="c1"># unilateral</span>

            <span class="n">data_ori_p</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">data_ori</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># phase</span>
            <span class="n">data_ori_p</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">data_ori_p</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">180</span><span class="p">)</span>
            <span class="n">data_ori_p_single</span> <span class="o">=</span> <span class="n">data_ori_p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">f1</span><span class="p">)]</span>

    <span class="k">elif</span> <span class="n">true</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lienum</span><span class="p">):</span>
            <span class="n">data_ori_m</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data_ori</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">N</span>
            <span class="n">data_ori_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_ori_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="n">data_ori_m_single</span> <span class="o">=</span> <span class="n">data_ori_m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">f1</span><span class="p">)]</span>  <span class="c1"># 单边</span>

            <span class="n">data_ori_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">data_ori</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># 相位</span>
            <span class="n">data_ori_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">data_ori_p</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">180</span><span class="p">)</span>  <span class="c1"># -pi到pi转为0到2pi</span>
            <span class="n">data_ori_p_single</span> <span class="o">=</span> <span class="n">data_ori_p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">f1</span><span class="p">)]</span>

    <span class="c1"># % % 时域</span>
    <span class="n">data_ifft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">lienum</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lienum</span><span class="p">):</span>
        <span class="n">data_ifft</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">(</span><span class="n">data_ori</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">real</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_ifft</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_ori_m_single</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_ori_p_single</span><span class="p">)</span></div>

<span class="c1">#==================================interpolation=======================================</span>
<div class="viewcode-block" id="inter">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.inter">[docs]</a>
<span class="k">def</span> <span class="nf">inter</span><span class="p">(</span><span class="n">data_complex_five</span><span class="p">,</span><span class="n">e_theta</span><span class="p">,</span><span class="n">e_phi</span><span class="p">):</span>
    <span class="c1"># This Python file uses the following encoding: utf-8</span>

    <span class="c1"># =================This subroutine is an interpolation procedure for a five-dimensional function in a specific theta phi direction======================</span>
    <span class="c1"># data_complex_five is the original data, 5 dimensions</span>
    <span class="c1"># e_theta,e_phi is the incident direction</span>

    <span class="c1">#    Four adjacent points</span>
    <span class="n">down_theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">e_theta</span><span class="p">)</span>
    <span class="n">up_theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">e_theta</span><span class="p">)</span>
    <span class="n">down_phi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">e_phi</span><span class="p">)</span>
    <span class="n">up_phi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">e_phi</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">e_theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">e_theta</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">e_phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">e_phi</span><span class="p">)</span>

    <span class="n">numf</span><span class="o">=</span><span class="n">data_complex_five</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#    interpolation</span>
    <span class="n">data_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">181</span><span class="p">,</span> <span class="mi">361</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">data_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numf</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numf</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">data_complex</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data_complex_five</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                <span class="n">L1</span> <span class="o">=</span> <span class="n">data_complex</span><span class="p">[</span><span class="n">down_theta</span><span class="p">,</span> <span class="n">down_phi</span><span class="p">]</span>
                <span class="n">L2</span> <span class="o">=</span> <span class="n">data_complex</span><span class="p">[</span><span class="n">up_theta</span><span class="p">,</span> <span class="n">down_phi</span><span class="p">]</span>
                <span class="n">L3</span> <span class="o">=</span> <span class="n">data_complex</span><span class="p">[</span><span class="n">down_theta</span><span class="p">,</span> <span class="n">up_phi</span><span class="p">]</span>
                <span class="n">L4</span> <span class="o">=</span> <span class="n">data_complex</span><span class="p">[</span><span class="n">up_theta</span><span class="p">,</span> <span class="n">up_phi</span><span class="p">]</span>
                <span class="n">rt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">e_theta</span> <span class="o">-</span> <span class="n">down_theta</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.</span>
                <span class="n">rt0</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">rt1</span>
                <span class="n">rp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">e_phi</span> <span class="o">-</span> <span class="n">down_phi</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.</span>
                <span class="n">rp0</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">rp1</span>

                <span class="n">data_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt0</span> <span class="o">*</span> <span class="n">rp0</span> <span class="o">*</span> <span class="n">L1</span> <span class="o">+</span> <span class="n">rt1</span> <span class="o">*</span> <span class="n">rp0</span> <span class="o">*</span> <span class="n">L2</span> <span class="o">+</span> <span class="n">rt0</span> <span class="o">*</span> <span class="n">rp1</span> <span class="o">*</span> <span class="n">L3</span> <span class="o">+</span> <span class="n">rt1</span> <span class="o">*</span> <span class="n">rp1</span> <span class="o">*</span> <span class="n">L4</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_new</span><span class="p">)</span></div>

<span class="c1"># ==========================================complex expansion========================</span>
<div class="viewcode-block" id="expan">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.expan">[docs]</a>
<span class="k">def</span> <span class="nf">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c1"># This Python file uses the following encoding: utf-8</span>

    <span class="c1"># = == == == == This procedure is used as a subroutine to complete the expansion of the spectrum == == == == =</span>
    <span class="c1"># % N is the number of frequency points, that is, the spectrum that needs to be expanded</span>
    <span class="c1"># % f0 is the frequency step, MHz</span>
    <span class="c1"># % f1 is the starting frequency of the spectrum to be expanded, f2 is the cutoff frequency of the spectrum to be expanded</span>
    <span class="c1"># % The program only considers that the length of the expanded data is less than floor(N / 2), such as N = 10, the length of the expanded data &lt;= 5; N = 9, the length of the expanded data &lt;= 4</span>
    <span class="c1"># data 1 dimension</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">f0</span>  <span class="c1"># Frequency sequence</span>
    <span class="n">effective</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">delta_start</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">f1</span><span class="p">)</span>  <span class="c1"># Difference from f1</span>
    <span class="n">delta_end</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">f2</span><span class="p">)</span>  <span class="c1"># Difference with f2</span>
    <span class="n">f_hang_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta_start</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">delta_start</span><span class="p">))</span>  <span class="c1"># The row with the smallest difference</span>
    <span class="n">f_hang_start</span> <span class="o">=</span> <span class="n">f_hang_start</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f_hang_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta_end</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">delta_end</span><span class="p">))</span>
    <span class="n">f_hang_end</span> <span class="o">=</span> <span class="n">f_hang_end</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data_expansion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f_hang_start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">data_expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">add</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">f_hang_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="n">effective</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">duichen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="n">effective</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data_expansion</span><span class="p">[</span><span class="n">add</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data_expansion</span><span class="p">[</span><span class="n">f_hang_start</span><span class="p">:</span> <span class="n">f_hang_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">data_expansion</span><span class="p">[</span><span class="n">duichen</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">f_hang_start</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">f_hang_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="n">f_hang_start</span> <span class="o">-</span> <span class="n">effective</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">f_hang_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Need to make up 0;</span>
        <span class="n">add</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">+</span> <span class="n">a3</span>
        <span class="n">add</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
        <span class="n">duichen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">f_hang_start</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="n">f_hang_start</span> <span class="o">-</span> <span class="n">effective</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data_expansion</span><span class="p">[</span><span class="n">add</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data_expansion</span><span class="p">[</span><span class="n">f_hang_start</span><span class="p">:</span> <span class="n">f_hang_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:]</span>
        <span class="n">data_expansion</span><span class="p">[</span><span class="n">duichen</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">data_expansion</span></div>


<span class="c1"># ==================================equivalent=========================================</span>
<div class="viewcode-block" id="CEL">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.CEL">[docs]</a>
<span class="k">def</span> <span class="nf">CEL</span><span class="p">(</span><span class="n">e_theta</span><span class="p">,</span> <span class="n">e_phi</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">):</span>
    <span class="c1"># This Python file uses the following encoding: utf-8</span>

    <span class="c1"># from complex_expansion import expan</span>

    <span class="c1"># = == == == == This program is used as a subroutine to complete the calculation and expansion of the 30-250MHz complex equivalent length == == == == =</span>
    <span class="c1">#  ----------------------input- ---------------------------------- %</span>
    <span class="c1"># filename address, S1P file (delete the previous string of s1p file in advance, put the test results of the three ports in the antennaVSWR folder, and name them 1 2 3 in turn)</span>
    <span class="c1"># % show_flag :flag of showing picture</span>
    <span class="c1"># N is the extended length</span>
    <span class="c1"># e_theta, e_phi is the direction of incidence</span>
    <span class="c1"># If unit is 0, the test data is in the form of real and imaginary parts, and 1 is in the form of db and phase.</span>
    <span class="c1"># f0 is the frequency resolution,</span>
    <span class="c1"># % ----------------------output - ---------------------------------- %</span>
    <span class="c1"># f frequency sequence, the default unit is MHz</span>
    <span class="c1"># Lce_complex_expansion is the equivalent length of a specific incident direction</span>
    <span class="c1"># s11_complex is the antenna test data</span>

    <span class="c1"># Complex electric field 30-250MHz</span>
    <span class="n">REfile</span> <span class="o">=</span> <span class="s2">&quot;.//Complex_RE.mat&quot;</span>
    <span class="n">RE</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">REfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">RE_zb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">RE</span><span class="p">[</span><span class="s1">&#39;data_rE_ALL&#39;</span><span class="p">])</span>
    <span class="n">re_complex</span> <span class="o">=</span> <span class="n">RE_zb</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span>
    <span class="n">f_radiation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">RE</span><span class="p">[</span><span class="s1">&#39;f_radiation&#39;</span><span class="p">])</span>  <span class="c1"># mhz</span>
    <span class="n">effective</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">f_radiation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_radiation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">e_radiation</span> <span class="o">=</span> <span class="n">inter</span><span class="p">(</span><span class="n">re_complex</span><span class="p">,</span> <span class="n">e_theta</span><span class="p">,</span> <span class="n">e_phi</span><span class="p">)</span>

    <span class="c1"># 测试s1p</span>
    <span class="n">s11_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">effective</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>  <span class="c1"># 3 ports</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">str_p</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;.//antennaVSWR//&quot;</span> <span class="o">+</span> <span class="n">str_p</span> <span class="o">+</span> <span class="s2">&quot;.s1p&quot;</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span>  <span class="c1"># HZ to MHz</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">db</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">re</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">im</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">db</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">re</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">deg</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">deg</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
        <span class="n">dB</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span>

        <span class="c1"># Interpolation is a data of 30-250mhz interval 1mhz</span>
        <span class="n">freqnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">f_re</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">renew</span> <span class="o">=</span> <span class="n">f_re</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">f_im</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">imnew</span> <span class="o">=</span> <span class="n">f_im</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">s11_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">renew</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imnew</span>

    <span class="c1"># %Reduced current</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I_complex</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">z0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s11_complex</span><span class="p">)</span> <span class="o">*</span> <span class="n">a1</span>

    <span class="c1"># %Denominator</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="mi">120</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">1e8</span>
    <span class="n">f_unit</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">lamda</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_radiation</span> <span class="o">*</span> <span class="n">f_unit</span><span class="p">)</span>  <span class="c1"># m</span>
    <span class="n">lamda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">lamda</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">lamda</span>
    <span class="n">fenmu</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">I_complex</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lamda</span><span class="p">)</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span>

    <span class="c1"># Equivalent length</span>
    <span class="c1"># Extend the frequency band</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f_radiation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">f_radiation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">Lce_complex_short</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">effective</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">Lce_complex_expansion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>  <span class="c1"># Polarization i = 1, 2, 3 respectively represent xyz polarization</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="c1"># Xyz polarization of a single port</span>
            <span class="n">Lce_complex_short</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_radiation</span><span class="p">[:,</span> <span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">fenmu</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span>
            <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">Lce_complex_expansion</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">Lce_complex_short</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">show_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">dB</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{S_</span><span class="si">{11}</span><span class="s2">/dB} $&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{S_</span><span class="si">{11}</span><span class="s2">}$&quot;</span> <span class="o">+</span> <span class="s2">&quot; of Antenna&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">string</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Lce_complex_expansion</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;X polarization&quot;</span><span class="p">,</span> <span class="s2">&quot;Y polarization&quot;</span><span class="p">,</span> <span class="s2">&quot;Z polarization&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Equivalent length / m&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular</span><span class="si">{L_e}</span><span class="s2">$&quot;</span> <span class="o">+</span> <span class="s2">&quot; in &quot;</span> <span class="o">+</span> <span class="n">string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; direction&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>  <span class="c1"># The smaller the value, the farther away</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Lce_complex_expansion</span><span class="p">,</span> <span class="n">s11_complex</span></div>



<span class="c1"># =========================================galacticnoise get=============================================</span>
<div class="viewcode-block" id="gala">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.gala">[docs]</a>
<span class="k">def</span> <span class="nf">gala</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">):</span>
    <span class="c1"># This Python file uses the following encoding: utf-8</span>


    <span class="c1"># = == == == == This program is used as a subroutine to complete the calculation and expansion of galactic noise == == == == =</span>
    <span class="c1">#  ----------------------input - ---------------------------------- %</span>
    <span class="c1"># lst：Select the galactic noise LST at the LST moment</span>
    <span class="c1"># N is the extended length</span>
    <span class="c1"># f0 is the frequency resolution, f1 is the frequency point of the unilateral spectrum</span>
    <span class="c1"># % ----------------------output - ---------------------------------- %</span>
    <span class="c1"># v_complex_double, galactic_v_time</span>

    <span class="n">GALAshowFile</span> <span class="o">=</span> <span class="s2">&quot;.//30_250galactic.mat&quot;</span>
    <span class="n">GALAshow</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">GALAshowFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">GALApsd_dbm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">GALAshow</span><span class="p">[</span><span class="s1">&#39;psd_narrow_huatu&#39;</span><span class="p">])</span>
    <span class="n">GALApower_dbm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">GALAshow</span><span class="p">[</span><span class="s1">&#39;p_narrow_huatu&#39;</span><span class="p">])</span>
    <span class="n">GALAvoltage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">GALAshow</span><span class="p">[</span><span class="s1">&#39;v_amplitude&#39;</span><span class="p">])</span>
    <span class="n">GALApower_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">GALAshow</span><span class="p">[</span><span class="s1">&#39;p_narrow&#39;</span><span class="p">])</span>
    <span class="n">GALAfreq</span> <span class="o">=</span> <span class="n">GALAshow</span><span class="p">[</span><span class="s1">&#39;freq_all&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">show_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">GALAfreq</span><span class="p">,</span> <span class="n">GALApsd_dbm</span><span class="p">[:,</span> <span class="n">g</span><span class="p">,</span> <span class="n">lst</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;PSD(dBm/Hz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Galactic Noise PSD&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">GALAfreq</span><span class="p">,</span> <span class="n">GALApower_dbm</span><span class="p">[:,</span> <span class="n">g</span><span class="p">,</span> <span class="n">lst</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Power(dBm)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Galactic Noise Power&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">GALAfreq</span><span class="p">,</span> <span class="n">GALAvoltage</span><span class="p">[:,</span> <span class="n">g</span><span class="p">,</span> <span class="n">lst</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Voltage(uV)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Galactic Noise Voltage&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">f_start</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">f_end</span> <span class="o">=</span> <span class="mi">250</span>

    <span class="n">R</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">v_complex_double</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">176</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">galactic_v_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">176</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">galactic_v_m_single</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">176</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">galactic_v_p_single</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">176</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">unit_uv</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">V_amplitude</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GALApower_mag</span> <span class="o">*</span> <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">unit_uv</span>

    <span class="n">aa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">176</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">176</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">v_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">176</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">176</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">221</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">aa</span><span class="p">[</span><span class="n">mm</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">V_amplitude</span><span class="p">[</span><span class="n">ff</span><span class="p">,</span> <span class="n">pp</span><span class="p">])</span>
                <span class="n">phase</span><span class="p">[</span><span class="n">mm</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>  <span class="c1"># 加入一随机高斯白噪声的相位</span>
                <span class="n">v_complex</span><span class="p">[</span><span class="n">mm</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">aa</span><span class="p">[</span><span class="n">mm</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">pp</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span><span class="p">[</span><span class="n">mm</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">pp</span><span class="p">])</span>

    <span class="k">pass</span>

    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">176</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">v_complex_double</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="p">:,</span> <span class="n">port</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_start</span><span class="p">,</span> <span class="n">f_end</span><span class="p">,</span> <span class="n">v_complex</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="p">:,</span> <span class="n">port</span><span class="p">])</span>
            <span class="c1"># print(v_complex_double[k, :, port])</span>
        <span class="p">[</span><span class="n">galactic_v_time</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">galactic_v_m_single</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">galactic_v_p_single</span><span class="p">[</span><span class="n">kk</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ifftget</span><span class="p">(</span><span class="n">v_complex_double</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v_complex_double</span><span class="p">,</span> <span class="n">galactic_v_time</span></div>



<span class="c1"># ===========================================LNAparameter get===========================================</span>
<div class="viewcode-block" id="LNA_get">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.LNA_get">[docs]</a>
<span class="k">def</span> <span class="nf">LNA_get</span><span class="p">(</span><span class="n">antennas11_complex_short</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">):</span>
    <span class="c1"># This Python file uses the following encoding: utf-8</span>

    <span class="c1"># from complex_expansion import expan</span>

    <span class="c1"># = == == == == This program is used as a subroutine to complete the calculation and expansion of the LNA partial pressure coefficient == == == == =</span>
    <span class="c1">#  ----------------------input - ---------------------------------- %</span>
    <span class="c1"># antennas11_complex_short is the program after the interpolation of the antenna standing wave test result</span>
    <span class="c1"># LNA address, s2p file (delete the previous string of s2p file in advance, put the test results of the three ports in the LNASparameter folder, and name them 1 2 3 in turn, corresponding to xyz)</span>
    <span class="c1"># The unit of test frequency is hz</span>
    <span class="c1"># N is the extended length</span>
    <span class="c1"># If unit is 0, the test data is in the form of real and imaginary parts, and 1 is in the form of db and phase.</span>
    <span class="c1"># f0 is the frequency resolution,</span>
    <span class="c1"># % ----------------------output - ---------------------------------- %</span>
    <span class="c1"># rou1 rou2 rou3</span>

    <span class="n">z0</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="n">antenna_Gama_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="c1"># Antenna related parameter calculation</span>
        <span class="n">antennas11_short</span> <span class="o">=</span> <span class="n">antennas11_complex_short</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">f_start</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">f_end</span> <span class="o">=</span> <span class="mi">250</span>
        <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">antenna_Gama_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_start</span><span class="p">,</span> <span class="n">f_end</span><span class="p">,</span> <span class="n">antennas11_short</span><span class="p">[:,</span> <span class="n">p</span><span class="p">])</span>

    <span class="n">Zin_antenna</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">antenna_Gama_complex</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">antenna_Gama_complex</span><span class="p">)</span>

    <span class="n">LNA_Gama_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>  <span class="c1"># 3 ports</span>
    <span class="n">LNA_s21_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="c1">#  LNA parameter</span>
        <span class="n">str_p</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">LNA_Address</span> <span class="o">=</span> <span class="s2">&quot;.//LNASparameter//&quot;</span> <span class="o">+</span> <span class="n">str_p</span> <span class="o">+</span> <span class="s2">&quot;.s2p&quot;</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">LNA_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span>  <span class="c1"># HZ to MHz</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">LNA_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ims11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">LNA_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">res21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">LNA_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ims21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">LNA_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">dbs21</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">res21</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims21</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dbs11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">LNA_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">degs11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">LNA_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">mags11</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dbs11</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">res11</span> <span class="o">=</span> <span class="n">mags11</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">degs11</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">ims11</span> <span class="o">=</span> <span class="n">mags11</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">degs11</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

            <span class="n">dbs21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">LNA_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">degs21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">LNA_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">mags21</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dbs21</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">res21</span> <span class="o">=</span> <span class="n">mags21</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">degs21</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">ims21</span> <span class="o">=</span> <span class="n">mags21</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">degs21</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dBs21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
        <span class="n">dBs21</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbs21</span>

        <span class="c1"># 插值为30-250mhz间隔1mhz一个数据</span>
        <span class="n">freqnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">f_res11</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">res11</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">res11new</span> <span class="o">=</span> <span class="n">f_res11</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">f_ims11</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">ims11</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">ims11new</span> <span class="o">=</span> <span class="n">f_ims11</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">s11_complex</span> <span class="o">=</span> <span class="n">res11new</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims11new</span>
        <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">LNA_Gama_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_start</span><span class="p">,</span> <span class="n">f_end</span><span class="p">,</span> <span class="n">s11_complex</span><span class="p">)</span>

        <span class="n">f_res21</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">res21</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">res21new</span> <span class="o">=</span> <span class="n">f_res21</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">f_ims21</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">ims21</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">ims21new</span> <span class="o">=</span> <span class="n">f_ims21</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">s21_complex</span> <span class="o">=</span> <span class="n">res21new</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims21new</span>
        <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">LNA_s21_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_start</span><span class="p">,</span> <span class="n">f_end</span><span class="p">,</span> <span class="n">s21_complex</span><span class="p">)</span>

    <span class="n">Zin_LNA</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">LNA_Gama_complex</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">LNA_Gama_complex</span><span class="p">)</span>

    <span class="c1"># Partial pressure coefficient</span>
    <span class="n">rou1</span> <span class="o">=</span> <span class="n">Zin_LNA</span> <span class="o">/</span> <span class="p">(</span><span class="n">Zin_antenna</span> <span class="o">+</span> <span class="n">Zin_LNA</span><span class="p">)</span>
    <span class="n">rou2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">LNA_Gama_complex</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">antenna_Gama_complex</span> <span class="o">*</span> <span class="n">LNA_Gama_complex</span><span class="p">)</span>
    <span class="n">rou3</span> <span class="o">=</span> <span class="n">LNA_s21_complex</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">LNA_Gama_complex</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># drawing</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">dBs21</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{S_</span><span class="si">{21}</span><span class="s2">/dB} $&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{S_</span><span class="si">{21}</span><span class="s2">}$&quot;</span> <span class="o">+</span> <span class="s2">&quot; of LNA test&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rou1</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{mag(\rho_1)}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;the contribution of &quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$\mathregular{ \rho_1}$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rou2</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{mag(\rho_2)}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;the contribution of &quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$\mathregular{ \rho_2}$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rou3</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{mag(\rho_3)}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;the contribution of &quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$\mathregular{ \rho_3}$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">rou1</span><span class="p">,</span> <span class="n">rou2</span><span class="p">,</span> <span class="n">rou3</span></div>



<span class="c1"># ===============================================Filterparameter get====================================</span>
<div class="viewcode-block" id="filter_get">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.filter_get">[docs]</a>
<span class="k">def</span> <span class="nf">filter_get</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">):</span>
    <span class="c1"># This Python file uses the following encoding: utf-8</span>


    <span class="c1"># = == == == == This program is used as a subroutine to complete the calculation and expansion of the S parameters of the cable and filter == == == == =</span>
    <span class="c1">#  ----------------------input - ---------------------------------- %</span>
    <span class="c1"># filter :path of s2p file</span>
    <span class="c1"># The filter test data is in the Filterparameter folder (delete the previous string of the s2p file in advance and name it 1, because the three port filters are the same)</span>
    <span class="c1"># The cable test data is in the cableparameter folder (delete the previous string of the s2p file in advance and name it cable because the three ports are the same)</span>
    <span class="c1"># The unit of test frequency is hz</span>
    <span class="c1"># N is the extended length</span>
    <span class="c1"># If unit is 0, the test data is in the form of real and imaginary parts, and 1 is in the form of db and phase.</span>
    <span class="c1"># f0 is the frequency resolution,</span>
    <span class="c1"># % ----------------------output - ---------------------------------- %</span>
    <span class="c1"># cable_coefficient</span>
    <span class="c1"># filter_coefficient</span>

    <span class="n">Gain_VGA</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span>  <span class="c1"># dB</span>
    <span class="n">r_balun</span> <span class="o">=</span> <span class="mi">630</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">650</span>
    <span class="c1"># test filter without VGA</span>
    <span class="c1"># Gain_VGA = 0  # dB</span>
    <span class="c1"># r_balun = 1</span>
    <span class="n">cable_Gama_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>  <span class="c1"># 3 ports</span>
    <span class="n">cable_s21_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="c1">#  cable参数</span>
        <span class="c1"># str_p = str(p + 1)</span>
        <span class="c1"># cable_Address = &quot;.//data//cableparameter//&quot; + str_p + &quot;.s2p&quot;</span>
        <span class="n">cable_Address</span> <span class="o">=</span> <span class="s2">&quot;.//cableparameter//cable.s2p&quot;</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">cable_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span>  <span class="c1"># HZ to MHz</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">cable_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ims11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">cable_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">res21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">cable_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ims21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">cable_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">dbs21</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">res21</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims21</span><span class="p">))</span>
            <span class="n">dbs11</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">res11</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims11</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dbs11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">cable_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">degs11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">cable_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">mags11</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dbs11</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">res11</span> <span class="o">=</span> <span class="n">mags11</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">degs11</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">ims11</span> <span class="o">=</span> <span class="n">mags11</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">degs11</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

            <span class="n">dbs21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">cable_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">degs21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">cable_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">mags21</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dbs21</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">res21</span> <span class="o">=</span> <span class="n">mags21</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">degs21</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">ims21</span> <span class="o">=</span> <span class="n">mags21</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">degs21</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dBs21_cable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
            <span class="n">dBs11_cable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
        <span class="n">dBs21_cable</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbs21</span>
        <span class="n">dBs11_cable</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbs11</span>

        <span class="n">f_start</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">f_end</span> <span class="o">=</span> <span class="mi">250</span>
        <span class="c1"># Interpolation is a data of 30-250mhz interval 1mhz</span>
        <span class="n">freqnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">f_res11</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">res11</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">res11new</span> <span class="o">=</span> <span class="n">f_res11</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">f_ims11</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">ims11</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">ims11new</span> <span class="o">=</span> <span class="n">f_ims11</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">s11_complex</span> <span class="o">=</span> <span class="n">res11new</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims11new</span>
        <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">cable_Gama_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_start</span><span class="p">,</span> <span class="n">f_end</span><span class="p">,</span> <span class="n">s11_complex</span><span class="p">)</span>

        <span class="n">f_res21</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">res21</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">res21new</span> <span class="o">=</span> <span class="n">f_res21</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">f_ims21</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">ims21</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">ims21new</span> <span class="o">=</span> <span class="n">f_ims21</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">s21_complex</span> <span class="o">=</span> <span class="n">res21new</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims21new</span>
        <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">cable_s21_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_start</span><span class="p">,</span> <span class="n">f_end</span><span class="p">,</span> <span class="n">s21_complex</span><span class="p">)</span>
    <span class="c1"># drawing</span>
    <span class="k">if</span> <span class="n">show_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">dBs11_cable</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{S_</span><span class="si">{11}</span><span class="s2">}$&quot;</span> <span class="o">+</span> <span class="s2">&quot; mag/dB&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">dBs21_cable</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{S_</span><span class="si">{21}</span><span class="s2">}$&quot;</span> <span class="o">+</span> <span class="s2">&quot; mag/dB&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;S parameters of cable&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">cable_coefficient</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">cable_Gama_complex</span><span class="p">)</span> <span class="o">*</span> <span class="n">cable_s21_complex</span>

    <span class="c1">#  =================filter=========================================</span>
    <span class="n">filter_Gama_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>  <span class="c1"># 3个端口</span>
    <span class="n">filter_s21_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="c1">#  filter parameter</span>
        <span class="c1"># str_p = str(p + 1)</span>
        <span class="c1"># filter_Address = &quot;.//data//filterparameter//&quot; + str_p + &quot;.s2p&quot;</span>
        <span class="n">filter_Address</span> <span class="o">=</span> <span class="s2">&quot;.//filterparameter//1.s2p&quot;</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filter_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span>  <span class="c1"># HZ to MHz</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filter_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ims11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filter_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">res21_filter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filter_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ims21_filter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filter_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">dbs21</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">res21</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims21</span><span class="p">))</span>
            <span class="n">dbs11</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">res11</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims11</span><span class="p">))</span>
            <span class="n">dbs21_add_VGA</span> <span class="o">=</span> <span class="n">dbs21</span> <span class="o">+</span> <span class="n">Gain_VGA</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">r_balun</span><span class="p">)</span>
            <span class="n">mags21</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dbs21_add_VGA</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">degs21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">res21_filter</span> <span class="o">+</span> <span class="n">ims21_filter</span><span class="p">)</span>  <span class="c1"># Phase radians</span>
            <span class="n">res21</span> <span class="o">=</span> <span class="n">mags21</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">degs21</span><span class="p">)</span>
            <span class="n">ims21</span> <span class="o">=</span> <span class="n">mags21</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">degs21</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dbs11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filter_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">degs11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filter_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">mags11</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dbs11</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">res11</span> <span class="o">=</span> <span class="n">mags11</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">degs11</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">ims11</span> <span class="o">=</span> <span class="n">mags11</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">degs11</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

            <span class="n">dbs21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filter_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">dbs21_add_VGA</span> <span class="o">=</span> <span class="n">dbs21</span> <span class="o">+</span> <span class="n">Gain_VGA</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">r_balun</span><span class="p">)</span>
            <span class="n">degs21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filter_Address</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">mags21</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dbs21_add_VGA</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">res21</span> <span class="o">=</span> <span class="n">mags21</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">degs21</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">ims21</span> <span class="o">=</span> <span class="n">mags21</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">degs21</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="c1"># Filter S parameter display</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dBs21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
            <span class="n">dBs11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
            <span class="n">dBs21_add_VGA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
        <span class="n">dBs21</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbs21</span>
        <span class="n">dBs11</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbs11</span>
        <span class="n">dBs21_add_VGA</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbs21_add_VGA</span>
        <span class="c1"># 插值为30-250mhz间隔1mhz一个数据</span>
        <span class="n">freqnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">f_res11</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">res11</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">res11new</span> <span class="o">=</span> <span class="n">f_res11</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">f_ims11</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">ims11</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">ims11new</span> <span class="o">=</span> <span class="n">f_ims11</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">s11_complex</span> <span class="o">=</span> <span class="n">res11new</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims11new</span>
        <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">filter_Gama_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_start</span><span class="p">,</span> <span class="n">f_end</span><span class="p">,</span> <span class="n">s11_complex</span><span class="p">)</span>

        <span class="n">f_res21</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">res21</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">res21new</span> <span class="o">=</span> <span class="n">f_res21</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">f_ims21</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">ims21</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
        <span class="n">ims21new</span> <span class="o">=</span> <span class="n">f_ims21</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="n">s21_complex</span> <span class="o">=</span> <span class="n">res21new</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ims21new</span>
        <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">filter_s21_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expan</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f_start</span><span class="p">,</span> <span class="n">f_end</span><span class="p">,</span> <span class="n">s21_complex</span><span class="p">)</span>
    <span class="c1"># drawing</span>
    <span class="k">if</span> <span class="n">show_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">dBs11</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{S_</span><span class="si">{11}</span><span class="s2">}$&quot;</span> <span class="o">+</span> <span class="s2">&quot; mag/dB&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">dBs21</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{S_</span><span class="si">{21}</span><span class="s2">}$&quot;</span> <span class="o">+</span> <span class="s2">&quot; mag/dB&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;S parameters of Filter&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">dBs21_add_VGA</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency(MHz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathregular{S_</span><span class="si">{21}</span><span class="s2">}$&quot;</span> <span class="o">+</span> <span class="s2">&quot; mag/dB&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;port X&quot;</span><span class="p">,</span> <span class="s2">&quot;port Y&quot;</span><span class="p">,</span> <span class="s2">&quot;port Z&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;S parameters of Filter add VGA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">filter_coefficient</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">filter_Gama_complex</span><span class="p">)</span> <span class="o">*</span> <span class="n">filter_s21_complex</span>

    <span class="k">return</span> <span class="n">cable_coefficient</span><span class="p">,</span> <span class="n">filter_coefficient</span></div>



<span class="c1"># ===================================make_new=========================================</span>
<div class="viewcode-block" id="mkdir">
<a class="viewcode-back" href="../../src_outlib.html#src_outlib.xdu_rf_ref.mkdir">[docs]</a>
<span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="p">:</span>  <span class="c1"># Determine whether there is a folder, if it does not exist, create a folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># makedirs If the path does not exist when creating the file, it will be created</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---  new folder...  ---&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---  OK  ---&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- folder already exist!  ---&quot;</span><span class="p">)</span></div>







<span class="c1">#=====================================================!!!Start the main program from here!!!=========================================</span>
<span class="n">rootdir</span> <span class="o">=</span> <span class="s2">&quot;..//data//&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rootdir</span><span class="p">)</span>
<span class="n">verse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">target</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">rootdir</span><span class="p">):</span>
        <span class="c1"># print(root)</span>
    <span class="c1"># print(os.path.isdir(root))</span>
    <span class="c1"># if os.path.isdir(root) == True:            #Determine whether it is a folder</span>
        <span class="n">verse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="c1"># print(root)</span>
<span class="c1"># print(verse)</span>
<span class="c1"># print(type(verse))</span>
<span class="c1">#=====================================If the folder starts with Stshp, add the target to be processed================================</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">verse</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Stshp_&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="c1"># print(target)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)):</span>
    <span class="n">file_dir</span> <span class="o">=</span> <span class="s2">&quot;..//data//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file_dir</span><span class="p">)</span>
    <span class="n">list1</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">target_trace</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">primary</span> <span class="o">=</span> <span class="n">list1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">list1</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">e_theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">list1</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">e_phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">list1</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">case</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">list1</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>


    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;primary is:&quot;</span> <span class="p">,</span> <span class="n">primary</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;energy is:&quot;</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="s2">&quot;Eev&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;theta is:&quot;</span><span class="p">,</span> <span class="n">e_theta</span><span class="p">,</span> <span class="s2">&quot;degree&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phi is:&quot;</span><span class="p">,</span> <span class="n">e_phi</span><span class="p">,</span> <span class="s2">&quot;degree&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;case num is:&quot;</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
<span class="c1">#==================================switch===========================================</span>

    <span class="n">savetxt</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># savetxt=0 Don&#39;t save output file ,savetxt=1 save output file</span>
    <span class="n">show_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">noise_flag</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="k">if</span> <span class="n">savetxt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">noise_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">outfile_voc</span> <span class="o">=</span>  <span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;//output_withoutnoise//voc&#39;</span>
            <span class="n">outfile_vlna</span> <span class="o">=</span>  <span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;//output_withoutnoise//Vlna&#39;</span>
            <span class="n">outfile_vcable</span> <span class="o">=</span>  <span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;//output_withoutnoise//Vlna_cable&#39;</span>
            <span class="n">outfile_vfilter</span> <span class="o">=</span>  <span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;//output_withoutnoise//Vfilter&#39;</span>
        <span class="k">elif</span> <span class="n">noise_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">outfile_voc</span> <span class="o">=</span> <span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;//output//voc&#39;</span>
            <span class="n">outfile_vlna</span> <span class="o">=</span> <span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;//output//Vlna&#39;</span>
            <span class="n">outfile_vcable</span> <span class="o">=</span> <span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;//output//Vlna_cable&#39;</span>
            <span class="n">outfile_vfilter</span> <span class="o">=</span> <span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;//output//Vfilter&#39;</span>

        <span class="n">mkdir</span><span class="p">(</span><span class="n">outfile_voc</span><span class="p">)</span>
        <span class="n">mkdir</span><span class="p">(</span><span class="n">outfile_vlna</span><span class="p">)</span>
        <span class="n">mkdir</span><span class="p">(</span><span class="n">outfile_vcable</span><span class="p">)</span>
        <span class="n">mkdir</span><span class="p">(</span><span class="n">outfile_vfilter</span><span class="p">)</span>
<span class="c1">#==========================Write particle type, energy level, angle, and event number into parameter.txt========================</span>
    <span class="n">case_index</span> <span class="o">=</span> <span class="s1">&#39;primary is:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">primary</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;;           energy is: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Eev;          theta is: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">e_theta</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; degree;          phi is: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e_phi</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; degree;          case num is:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;//parameter.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">case_index</span><span class="p">)</span>

        <span class="n">source_root</span> <span class="o">=</span> <span class="n">file_dir</span> <span class="o">+</span> <span class="s1">&#39;//antpos.dat&#39;</span>
        <span class="n">target_root</span> <span class="o">=</span> <span class="s2">&quot;..//result//&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">source_root</span><span class="p">,</span><span class="n">target_root</span><span class="p">)</span>

        <span class="c1"># ===================================Arbitrary input file first generates input parameters needed by subroutine================================================</span>
        <span class="c1">#  ================================Change according to actual situation==========================================</span>
        <span class="c1"># Select the galactic noise LST at the LST moment</span>
        <span class="c1"># lst = int(input(&quot;please input lst:&quot;))</span>
        <span class="c1"># demo = int(input(&quot;please input demo number:&quot;))</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="mi">18</span>
        <span class="n">Ts</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Manually enter the same time interval as the .trace file</span>
        <span class="n">randomn</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">E_path</span> <span class="o">=</span> <span class="n">file_dir</span> <span class="o">+</span> <span class="s1">&#39;//a&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">randomn</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.trace&#39;</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">file_dir</span><span class="p">):</span>
            <span class="c1"># print(root)</span>
            <span class="c1"># print(os.path.isdir(root))</span>
            <span class="c1"># if os.path.isdir(root) == True:            #判断是否为文件夹</span>
            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
            <span class="c1"># print(os.path.splitext(b)[1])</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">b</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.trace&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">target_trace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="c1">#  ===========================start calculating===================</span>
        <span class="p">[</span><span class="n">t_cut</span><span class="p">,</span> <span class="n">ex_cut</span><span class="p">,</span> <span class="n">ey_cut</span><span class="p">,</span> <span class="n">ez_cut</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_data_get</span><span class="p">(</span><span class="n">E_path</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">)</span>  <span class="c1"># Signal interception</span>

        <span class="n">Edata</span> <span class="o">=</span> <span class="n">ex_cut</span>
        <span class="n">Edata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Edata</span><span class="p">,</span> <span class="n">ey_cut</span><span class="p">))</span>
        <span class="n">Edata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Edata</span><span class="p">,</span> <span class="n">ez_cut</span><span class="p">))</span>

        <span class="p">[</span><span class="n">E_shower_fft</span><span class="p">,</span> <span class="n">E_shower_fft_m_single</span><span class="p">,</span> <span class="n">E_shower_fft_p_single</span><span class="p">]</span> <span class="o">=</span> <span class="n">fftget</span><span class="p">(</span><span class="n">Edata</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span>
                                                                              <span class="n">show_flag</span><span class="p">)</span>  <span class="c1"># Frequency domain signal</span>
        <span class="c1"># =======Equivalent length================</span>
        <span class="p">[</span><span class="n">Lce_complex</span><span class="p">,</span> <span class="n">antennas11_complex_short</span><span class="p">]</span> <span class="o">=</span> <span class="n">CEL</span><span class="p">(</span><span class="n">e_theta</span><span class="p">,</span> <span class="n">e_phi</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">)</span>

        <span class="n">Lcehang</span> <span class="o">=</span> <span class="n">Lce_complex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Lcelie</span> <span class="o">=</span> <span class="n">Lce_complex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># ======Galaxy noise power spectrum density, power, etc.=====================</span>
        <span class="p">[</span><span class="n">galactic_v_complex_double</span><span class="p">,</span> <span class="n">galactic_v_time</span><span class="p">]</span> <span class="o">=</span> <span class="n">gala</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">)</span>
        <span class="c1"># =================== LNA=====================================================</span>
        <span class="p">[</span><span class="n">rou1_complex</span><span class="p">,</span> <span class="n">rou2_complex</span><span class="p">,</span> <span class="n">rou3_complex</span><span class="p">]</span> <span class="o">=</span> <span class="n">LNA_get</span><span class="p">(</span><span class="n">antennas11_complex_short</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">)</span>
        <span class="c1"># =======================  cable  filter VGA balun=============================================</span>
        <span class="p">[</span><span class="n">cable_coefficient</span><span class="p">,</span> <span class="n">filter_coefficient</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_get</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">)</span>


<span class="c1"># ===============================Start loop calculation========================================================================</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_trace</span><span class="p">)):</span>
        <span class="c1"># air shower,input file</span>
        <span class="n">E_path</span> <span class="o">=</span> <span class="n">file_dir</span><span class="o">+</span> <span class="s1">&#39;//a&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.trace&#39;</span>
        <span class="n">xunhuan</span> <span class="o">=</span> <span class="s1">&#39;//a&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_trace.txt&#39;</span>

        <span class="c1"># Output file path and name</span>
        <span class="c1">#  ===========================start calculating===========================================================</span>
        <span class="p">[</span><span class="n">t_cut</span><span class="p">,</span> <span class="n">ex_cut</span><span class="p">,</span> <span class="n">ey_cut</span><span class="p">,</span> <span class="n">ez_cut</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_data_get</span><span class="p">(</span><span class="n">E_path</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">show_flag</span><span class="p">)</span>  <span class="c1"># Signal interception</span>

        <span class="n">Edata</span> <span class="o">=</span> <span class="n">ex_cut</span>
        <span class="n">Edata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Edata</span><span class="p">,</span> <span class="n">ey_cut</span><span class="p">))</span>
        <span class="n">Edata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Edata</span><span class="p">,</span> <span class="n">ez_cut</span><span class="p">))</span>

        <span class="p">[</span><span class="n">E_shower_fft</span><span class="p">,</span> <span class="n">E_shower_fft_m_single</span><span class="p">,</span> <span class="n">E_shower_fft_p_single</span><span class="p">]</span> <span class="o">=</span> <span class="n">fftget</span><span class="p">(</span><span class="n">Edata</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span>
                                                                              <span class="n">show_flag</span><span class="p">)</span>  <span class="c1"># Frequency domain signal</span>

        <span class="c1"># =======Equivalent length================</span>

        <span class="c1"># ======Open circuit voltage of air shower=================</span>
        <span class="n">Voc_shower_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Lcehang</span><span class="p">,</span> <span class="n">Lcelie</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="c1"># Frequency domain signal</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Lcelie</span><span class="p">):</span>
            <span class="n">Voc_shower_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">Lce_complex</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">E_shower_fft</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Lce_complex</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">E_shower_fft</span><span class="p">[:,</span>
                                                                                                          <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Lce_complex</span><span class="p">[</span>
                                                                                                               <span class="p">:,</span> <span class="mi">2</span><span class="p">,</span>
                                                                                                               <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">E_shower_fft</span><span class="p">[</span>
                                                                                                                    <span class="p">:,</span>
                                                                                                                    <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span>
        <span class="c1"># time domain signal</span>
        <span class="p">[</span><span class="n">Voc_shower_t</span><span class="p">,</span> <span class="n">Voc_shower_m_single</span><span class="p">,</span> <span class="n">Voc_shower_p_single</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifftget</span><span class="p">(</span><span class="n">Voc_shower_complex</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># ======Galaxy noise power spectrum density, power, etc.=====================</span>

        <span class="c1"># ===========Voltage with added noise=======================================</span>
        <span class="n">Voc_noise_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Lcehang</span><span class="p">,</span> <span class="n">Lcelie</span><span class="p">))</span>
        <span class="n">Voc_noise_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Lcehang</span><span class="p">,</span> <span class="n">Lcelie</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Lcelie</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">noise_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Voc_noise_t</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">Voc_shower_t</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span>
                <span class="n">Voc_noise_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">Voc_shower_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">noise_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">Voc_noise_t</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">Voc_shower_t</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="n">galactic_v_time</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">175</span><span class="p">),</span> <span class="p">:,</span> <span class="n">p</span><span class="p">]</span>
                <span class="n">Voc_noise_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">Voc_shower_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="n">galactic_v_complex_double</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">175</span><span class="p">),</span> <span class="p">:,</span> <span class="n">p</span><span class="p">]</span>

        <span class="p">[</span><span class="n">Voc_noise_t_ifft</span><span class="p">,</span> <span class="n">Voc_noise_m_single</span><span class="p">,</span> <span class="n">Voc_noise_p_single</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifftget</span><span class="p">(</span><span class="n">Voc_noise_complex</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># ==================Voltage after LNA=====================================================</span>
        <span class="n">V_LNA_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">Lcelie</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Lcelie</span><span class="p">):</span>
            <span class="n">V_LNA_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">rou1_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">rou2_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">rou3_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">Voc_noise_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span>
        <span class="p">[</span><span class="n">V_LNA_t</span><span class="p">,</span> <span class="n">V_LNA_m_single</span><span class="p">,</span> <span class="n">V_LNA_p_single</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifftget</span><span class="p">(</span><span class="n">V_LNA_complex</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># ======================Voltage after  cable=============================================</span>
        <span class="n">V_cable_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">Lcelie</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Lcelie</span><span class="p">):</span>
            <span class="n">V_cable_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_LNA_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">cable_coefficient</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span>
        <span class="p">[</span><span class="n">V_cable_t</span><span class="p">,</span> <span class="n">V_cable_m_single</span><span class="p">,</span> <span class="n">V_cable_p_single</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifftget</span><span class="p">(</span><span class="n">V_cable_complex</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># ======================Voltage after filter=============================================</span>
        <span class="n">V_filter_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">Lcelie</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Lcelie</span><span class="p">):</span>
            <span class="n">V_filter_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_LNA_complex</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">cable_coefficient</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">filter_coefficient</span><span class="p">[:,</span> <span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span>
        <span class="p">[</span><span class="n">V_filter_t</span><span class="p">,</span> <span class="n">V_filter_m_single</span><span class="p">,</span> <span class="n">V_filter_p_single</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifftget</span><span class="p">(</span><span class="n">V_filter_complex</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># ====================Voltage after ADC======================================</span>
        <span class="n">Length_AD</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># Significant bit of the value, plus a sign bit in addition to this</span>
        <span class="n">Range_AD</span> <span class="o">=</span> <span class="mf">1.8</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># Vpp,unit:uv</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">Range_AD</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">Length_AD</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">V_ADC_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">V_filter_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">V_filter_t</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span>
        <span class="c1"># ======================save .txt=============================================</span>
        <span class="k">if</span> <span class="n">savetxt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># time--ns,Voltage----uV</span>
            <span class="c1"># Open circuit voltage</span>
            <span class="n">V_output1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">Lcelie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">V_output1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_cut</span>
            <span class="n">V_output1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">Voc_shower_t</span><span class="p">[:,</span> <span class="p">:]</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">outfile_voc</span> <span class="o">+</span> <span class="n">xunhuan</span><span class="p">,</span> <span class="n">V_output1</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.10e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="c1"># LNA</span>
            <span class="n">V_output4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">Lcelie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">V_output4</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_cut</span>
            <span class="n">V_output4</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">V_LNA_t</span><span class="p">[:,</span> <span class="p">:]</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">outfile_vlna</span> <span class="o">+</span> <span class="n">xunhuan</span><span class="p">,</span> <span class="n">V_output4</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.10e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="c1"># cable</span>
            <span class="n">V_output2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">Lcelie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">V_output2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_cut</span>
            <span class="n">V_output2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">V_cable_t</span><span class="p">[:,</span> <span class="p">:]</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">outfile_vcable</span> <span class="o">+</span> <span class="n">xunhuan</span><span class="p">,</span> <span class="n">V_output2</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.10e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="c1"># filter</span>
            <span class="n">V_output3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">Lcelie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">V_output3</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_cut</span>
            <span class="n">V_output3</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">V_filter_t</span><span class="p">[:,</span> <span class="p">:]</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">outfile_vfilter</span> <span class="o">+</span> <span class="n">xunhuan</span><span class="p">,</span> <span class="n">V_output3</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.10e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="c1"># ======================delete target_trace=============================================</span>

    <span class="k">del</span> <span class="n">target_trace</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, GRAND Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>